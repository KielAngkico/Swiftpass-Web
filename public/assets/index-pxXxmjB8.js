import{r as l,j as e,d as y}from"./index-BYZoeFiF.js";import{O as b}from"./OwnerSidebar-CZ0OhogK.js";import{L as k,C as P,g as I,h as M,P as $,j as C,n as D,p as H,k as T}from"./index-CI_pAut9.js";import"./index-D-5OJeWc.js";P.register(I,M,$,C,D,H,T);const L=({title:r,value:c})=>e.jsxs("div",{className:"bg-white p-2 rounded shadow text-center text-xs sm:text-sm",children:[e.jsx("p",{className:"text-gray-500 truncate",children:r}),e.jsx("p",{className:"font-bold text-indigo-600 text-sm sm:text-base",children:c})]}),U=()=>{const[r,c]=l.useState(null),[i,h]=l.useState("all"),[u,d]=l.useState(0),[n,x]=l.useState([]),[f,m]=l.useState("—"),[a,p]=l.useState([]),[o,N]=l.useState([]),[w,v]=l.useState(!0),[g,j]=l.useState(null);l.useEffect(()=>{(async()=>{try{const{data:t}=await y.get("/api/me");if(!t.authenticated||!t.user)throw new Error("Not authenticated");c(t.user.adminId)}catch{j("Failed to authenticate")}finally{v(!1)}})()},[]),l.useEffect(()=>{if(!r)return;(async()=>{try{const{data:t}=await y.get("/api/prepaid-activity-analytics",{params:{admin_id:r,range:i,system_type:"prepaid_entry"}});d(t.total_logins||0),x(t.scans_by_hour||[]),m(t.peak_hour||"—"),p(t.most_active_members||[]),N(t.entry_logs||[])}catch{}})()},[r,i]);const _={labels:n.map(s=>`${s.hour}:00`),datasets:[{label:"Logins",data:n.map(s=>s.count),borderColor:"#6366f1",backgroundColor:"rgba(99, 102, 241, 0.2)",tension:.4,fill:!0}]},A={responsive:!0,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:"Hour"},ticks:{font:{size:10}}},y:{beginAtZero:!0,title:{display:!0,text:"Logins"},ticks:{precision:0,font:{size:10}}}}};return w?e.jsx("p",{className:"text-xs",children:"Loading analytics..."}):g?e.jsx("p",{className:"text-red-500 text-xs",children:g}):e.jsxs("div",{className:"min-h-screen w-full bg-white p-2 flex flex-col space-y-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Prepaid Activity Analytics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Overview of member activity and logins"}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs",children:["today","yesterday","last-7-days","all"].map(s=>e.jsx("button",{className:`px-3 py-1 rounded text-xs font-medium ${i===s?"bg-indigo-600 text-white":"bg-white border text-gray-700"}`,onClick:()=>h(s),children:s.replace("-"," ").toUpperCase()},s))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:[e.jsx(L,{title:"Total Members Inside",value:o.filter(s=>s.status==="inside").length}),e.jsx(L,{title:"Total Logins",value:u}),e.jsx(L,{title:"Peak Hour",value:f})]}),e.jsxs("div",{className:"bg-white p-2 sm:p-4 rounded shadow",children:[e.jsx("h2",{className:"text-sm font-semibold mb-2",children:"🟢 Members Inside"}),e.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1 text-xs",children:o.filter(s=>s.status==="inside").map((s,t)=>e.jsxs("li",{className:"bg-green-50 px-2 py-1 rounded shadow flex justify-between items-center text-[10px]",children:[e.jsx("span",{children:s.full_name}),e.jsx("span",{className:"font-mono text-green-700",children:s.rfid_tag})]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-2 sm:p-4 rounded shadow",children:[e.jsx("h2",{className:"text-sm font-semibold mb-2",children:"📈 Logins by Hour"}),n.length===0?e.jsx("p",{className:"text-gray-400 italic text-xs",children:"No login data available."}):e.jsx(k,{data:_,options:A})]}),e.jsxs("div",{className:"bg-white p-2 sm:p-4 rounded shadow",children:[e.jsx("h2",{className:"text-sm font-semibold mb-2",children:"🏆 Top 3 Most Active"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 text-center mt-8 text-[10px]",children:[1,0,2].map(s=>a[s]?e.jsxs("div",{className:`p-2 rounded shadow flex flex-col items-center gap-1 ${s===0?"bg-yellow-100 text-yellow-700 scale-105 z-10":s===1?"bg-gray-200 text-gray-700":"bg-orange-100 text-orange-700"}`,children:[e.jsx("div",{className:"text-xl",children:s===0?"🥇":s===1?"🥈":"🥉"}),e.jsx("img",{src:`http://localhost:5000/${a[s].profile_image_url||"default-profile.png"}`,alt:a[s].full_name,className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover border"}),e.jsx("p",{className:"font-semibold",children:a[s].full_name}),e.jsxs("p",{className:"text-[9px]",children:["Visits: ",a[s].login_count]})]},s):e.jsx("div",{},s))})]})]}),e.jsxs("div",{className:"bg-white rounded shadow overflow-hidden",children:[e.jsx("h2",{className:"text-sm font-semibold px-2 py-2 border-b",children:"🧾 Member Activity Logs"}),e.jsx("div",{className:"overflow-x-auto max-h-[350px] overflow-y-auto scroll-smooth text-[10px] sm:text-xs",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-gray-700 text-white uppercase text-[9px] sm:text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"#"}),e.jsx("th",{className:"px-2 py-1",children:"Profile"}),e.jsx("th",{className:"px-2 py-1",children:"Name"}),e.jsx("th",{className:"px-2 py-1",children:"RFID"}),e.jsx("th",{className:"px-2 py-1",children:"Entry"}),e.jsx("th",{className:"px-2 py-1",children:"Exit"}),e.jsx("th",{className:"px-2 py-1",children:"Status"})]})}),e.jsx("tbody",{children:o.map((s,t)=>e.jsxs("tr",{className:t%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1",children:t+1}),e.jsx("td",{className:"px-2 py-1",children:s.profile_image_url?e.jsx("img",{src:`http://localhost:5000/${s.profile_image_url}`,alt:s.full_name,onError:S=>S.target.src="/default-profile.png",className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover border"}):e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gray-200 flex items-center justify-center text-[8px] sm:text-xs text-gray-500",children:"N/A"})}),e.jsx("td",{className:"px-2 py-1 font-medium",children:s.full_name}),e.jsx("td",{className:"px-2 py-1 font-mono",children:s.rfid_tag}),e.jsx("td",{className:"px-2 py-1",children:s.entry_time||"—"}),e.jsx("td",{className:"px-2 py-1",children:s.exit_time||"—"}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("span",{className:`px-1 py-0.5 rounded-full text-[8px] sm:text-xs font-semibold ${s.status==="inside"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:s.status})})]},t))})]})})]})]})};P.register(I,M,$,C,D,H,T);const E=({title:r,value:c})=>e.jsxs("div",{className:"bg-white p-2 rounded shadow text-center text-xs sm:text-sm",children:[e.jsx("p",{className:"text-gray-500 truncate",children:r}),e.jsx("p",{className:"font-bold text-indigo-600 text-sm sm:text-base",children:c})]}),F=()=>{const[r,c]=l.useState(null),[i,h]=l.useState("all"),[u,d]=l.useState(0),[n,x]=l.useState([]),[f,m]=l.useState("—"),[a,p]=l.useState([]),[o,N]=l.useState([]),[w,v]=l.useState(!0),[g,j]=l.useState(null);l.useEffect(()=>{(async()=>{try{const{data:t}=await y.get("/api/me");if(!t.authenticated||!t.user)throw new Error;c(t.user.adminId)}catch{j("Failed to authenticate")}finally{v(!1)}})()},[]),l.useEffect(()=>{if(!r)return;(async()=>{try{const{data:t}=await y.get("/api/prepaid-activity-analytics",{params:{admin_id:r,range:i,system_type:"subscription"}});d(t.total_logins||0),x(t.scans_by_hour||[]),m(t.peak_hour||"—"),p(t.most_active_members||[]),N(t.entry_logs||[])}catch{j("Failed to fetch subscription analytics")}})()},[r,i]);const _={labels:n.map(s=>`${s.hour}:00`),datasets:[{label:"Logins",data:n.map(s=>s.count),borderColor:"#6366f1",backgroundColor:"rgba(99, 102, 241, 0.2)",tension:.4,fill:!0}]},A={responsive:!0,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:"Hour"},ticks:{font:{size:10}}},y:{beginAtZero:!0,title:{display:!0,text:"Logins"},ticks:{precision:0,font:{size:10}}}}};return w?e.jsx("p",{className:"text-xs",children:"Loading analytics..."}):g?e.jsx("p",{className:"text-red-500 text-xs",children:g}):e.jsxs("div",{className:"min-h-screen w-full bg-white p-2 flex flex-col space-y-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold",children:"Subscription Activity Analytics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Overview of subscription member activity"}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs",children:["today","yesterday","last-7-days","all"].map(s=>e.jsx("button",{className:`px-3 py-1 rounded text-xs font-medium ${i===s?"bg-indigo-600 text-white":"bg-white border text-gray-700"}`,onClick:()=>h(s),children:s.replace("-"," ").toUpperCase()},s))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:[e.jsx(E,{title:"Members Inside",value:o.filter(s=>s.status==="inside").length}),e.jsx(E,{title:"Total Logins",value:u}),e.jsx(E,{title:"Peak Hour",value:f})]}),e.jsxs("div",{className:"bg-white p-2 sm:p-4 rounded shadow",children:[e.jsx("h2",{className:"text-sm font-semibold mb-2",children:"🟢 Members Inside"}),e.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1 text-xs",children:o.filter(s=>s.status==="inside").map((s,t)=>e.jsxs("li",{className:"bg-green-50 px-2 py-1 rounded shadow flex justify-between items-center text-[10px]",children:[e.jsx("span",{children:s.full_name}),e.jsx("span",{className:"font-mono text-green-700",children:s.rfid_tag})]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-2 sm:p-4 rounded shadow",children:[e.jsx("h2",{className:"text-sm font-semibold mb-2",children:"📈 Logins by Hour"}),n.length===0?e.jsx("p",{className:"text-gray-400 italic text-xs",children:"No login data available."}):e.jsx(k,{data:_,options:A})]}),e.jsxs("div",{className:"bg-white p-2 sm:p-4 rounded shadow",children:[e.jsx("h2",{className:"text-sm font-semibold mb-2",children:"🏆 Top 3 Most Active"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 text-center mt-8 text-[10px]",children:[1,0,2].map(s=>a[s]?e.jsxs("div",{className:`p-2 rounded shadow flex flex-col items-center gap-1 ${s===0?"bg-yellow-100 text-yellow-700 scale-105 z-10":s===1?"bg-gray-200 text-gray-700":"bg-orange-100 text-orange-700"}`,children:[e.jsx("div",{className:"text-xl",children:s===0?"🥇":s===1?"🥈":"🥉"}),e.jsx("img",{src:`http://localhost:5000/${a[s].profile_image_url||"default-profile.png"}`,alt:a[s].full_name,className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover border"}),e.jsx("p",{className:"font-semibold",children:a[s].full_name}),e.jsxs("p",{className:"text-[9px]",children:["Visits: ",a[s].login_count]}),a[s].subscription_type&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-[9px] italic text-gray-600",children:["Plan: ",a[s].subscription_type]}),e.jsxs("p",{className:"text-[9px] text-gray-500",children:[new Date(a[s].subscription_start).toLocaleDateString()," –"," ",new Date(a[s].subscription_expiry).toLocaleDateString()]})]})]},s):e.jsx("div",{},s))})]})]}),e.jsxs("div",{className:"bg-white rounded shadow overflow-hidden",children:[e.jsx("h2",{className:"text-sm font-semibold px-2 py-2 border-b",children:"🧾 Member Activity Logs"}),e.jsx("div",{className:"overflow-x-auto max-h-[350px] overflow-y-auto scroll-smooth text-[10px] sm:text-xs",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-gray-700 text-white uppercase text-[9px] sm:text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"#"}),e.jsx("th",{className:"px-2 py-1",children:"Profile"}),e.jsx("th",{className:"px-2 py-1",children:"Name"}),e.jsx("th",{className:"px-2 py-1",children:"RFID"}),e.jsx("th",{className:"px-2 py-1",children:"Entry"}),e.jsx("th",{className:"px-2 py-1",children:"Exit"}),e.jsx("th",{className:"px-2 py-1",children:"Status"})]})}),e.jsx("tbody",{children:o.map((s,t)=>e.jsxs("tr",{className:t%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1",children:t+1}),e.jsx("td",{className:"px-2 py-1",children:s.profile_image_url?e.jsx("img",{src:`http://localhost:5000/${s.profile_image_url}`,alt:s.full_name,onError:S=>S.target.src="/default-profile.png",className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover border"}):e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gray-200 flex items-center justify-center text-[8px] sm:text-xs text-gray-500",children:"N/A"})}),e.jsx("td",{className:"px-2 py-1 font-medium",children:s.full_name}),e.jsx("td",{className:"px-2 py-1 font-mono",children:s.rfid_tag}),e.jsx("td",{className:"px-2 py-1",children:s.entry_time||"—"}),e.jsx("td",{className:"px-2 py-1",children:s.exit_time||"—"}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("span",{className:`px-1 py-0.5 rounded-full text-[8px] sm:text-xs font-semibold ${s.status==="inside"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:s.status})})]},t))})]})})]})]})},V=()=>{const[r,c]=l.useState(null),[i,h]=l.useState(""),[u,d]=l.useState(!0),[n,x]=l.useState(null);return l.useEffect(()=>{(async()=>{var m;try{d(!0),x(null);const{data:a}=await y.get("/api/me");if(console.log("📥 Admin info response:",a),!a.authenticated||!a.user)throw new Error("Not authenticated");if(a.user.role!=="admin"&&a.user.role!=="owner")throw new Error("Only admin/owner can access Activity Analytics");c(a.user);const p=a.user.systemType||a.user.system_type||"";h(p),console.log("🔍 System type:",p)}catch(a){console.error("❌ Failed to fetch admin info:",a),x(a.message||"Failed to fetch admin info"),((m=a.response)==null?void 0:m.status)===401&&(window.location.href="/login")}finally{d(!1)}})()},[]),u?e.jsxs("div",{className:"flex",children:[e.jsx(b,{}),e.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⏳"}),e.jsx("p",{className:"text-gray-600",children:"Loading Activity Analytics..."})]})]}):n?e.jsxs("div",{className:"flex",children:[e.jsx(b,{}),e.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"❌"}),e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:n}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})]}):i?e.jsxs("div",{className:"flex",children:[e.jsx(b,{}),e.jsx("div",{className:"flex-1 p-4",children:i==="prepaid_entry"?e.jsx(U,{adminUser:r}):i==="subscription"?e.jsx(F,{adminUser:r}):e.jsxs("div",{className:"text-gray-600",children:['Unknown system type: "',i,'". Please contact support.']})})]}):e.jsxs("div",{className:"flex",children:[e.jsx(b,{}),e.jsx("div",{className:"flex-1 p-6 text-center py-12 text-gray-600",children:"Unknown system type. Please contact support."})]})};export{V as default};
