import{u as f,c as g,r as t,j as e,d as c}from"./index-BYZoeFiF.js";import{S as j}from"./SuperAdminSidebar-w5hGfztw.js";import"./index-D-5OJeWc.js";const P=()=>{var l;const{user:r}=f(),{rfidData:a}=g(),[n,d]=t.useState([]),[y,o]=t.useState([]),[N,x]=t.useState(!0),[m,b]=t.useState(""),[v,h]=t.useState(""),[w,S]=t.useState({name:"",quantity:1}),[R,I]=t.useState(null),[_,A]=t.useState(""),p=async()=>{try{const{data:s}=await c.get("/api/inventory");d(s)}catch{alert("Failed to fetch inventory")}finally{x(!1)}},u=async()=>{try{const{data:s}=await c.get("/api/rfid");o(s)}catch{console.error("RFID fetch error")}};return t.useEffect(()=>{r&&(p(),u())},[r]),t.useEffect(()=>{(a==null?void 0:a.location)==="SUPERADMIN"&&a.rfid_tag&&(console.log("ðŸ“¥ Received SUPERADMIN RFID:",a.rfid_tag),h(a.rfid_tag))},[a]),n.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())),r?e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(j,{}),e.jsxs("main",{className:"flex-1 p-4 space-y-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"Prepaid Analytical Dashboard"}),e.jsxs("select",{value:range,onChange:s=>setRange(s.target.value),className:"px-2 py-1 w-32 border border-gray-300 rounded-md text-xs text-gray-700 focus:outline-none focus:ring-1 focus:ring-indigo-500",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"}),e.jsx("option",{value:"last-7-days",children:"Last 7 Days"})]})]}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Overview of prepaid logins, revenue, and activity trends"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(KpiCard,{title:"Active Members Inside",value:analytics.active_members_inside,color:"text-blue-600",textSize:"text-sm"}),e.jsx(KpiCard,{title:"Prepaid Revenue Today",value:`â‚±${Number((analytics==null?void 0:analytics.prepaid_revenue_today)??0).toLocaleString()}`,color:"text-green-600",textSize:"text-sm"}),e.jsx(KpiCard,{title:"Total Prepaid Logins",value:Number((analytics==null?void 0:analytics.total_logins_today)??0),color:"text-purple-600",textSize:"text-sm"}),e.jsx(KpiCard,{title:"Peak Hour",value:analytics.peak_hour,color:"text-gray-700",textSize:"text-sm"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsxs("div",{className:"lg:w-3/4 w-full bg-white rounded-md shadow-sm p-2",children:[e.jsx("h2",{className:"text-xs font-semibold mb-2",children:"Login Trends by Hour"}),e.jsx(Line,{data:scanLineData,options:{maintainAspectRatio:!1}})]}),e.jsxs("div",{className:"lg:w-1/4 w-full bg-white rounded-md shadow-sm p-2",children:[e.jsx("h2",{className:"text-xs font-semibold mb-2",children:"Top-Up vs Session Breakdown"}),e.jsx(Pie,{data:actionsData,options:pieOptions})]})]}),e.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm max-h-[20rem] overflow-y-auto",children:[e.jsx("h2",{className:"text-xs font-semibold text-gray-800 mb-1",children:"Recent Prepaid Events"}),e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-white z-10",children:e.jsxs("tr",{className:"text-gray-600 border-b",children:[e.jsx("th",{className:"p-2 w-8 text-center",children:"#"}),e.jsx("th",{className:"p-2 text-left",children:"Member"}),e.jsx("th",{className:"p-2",children:"RFID"}),e.jsx("th",{className:"p-2",children:"Action"}),e.jsx("th",{className:"p-2",children:"Amount"}),e.jsx("th",{className:"p-2",children:"Time"}),e.jsx("th",{className:"p-2",children:"Balance After"})]})}),e.jsx("tbody",{children:((l=analytics==null?void 0:analytics.recent_events)==null?void 0:l.length)>0?analytics.recent_events.map((s,i)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 text-center text-gray-500",children:i+1}),e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2 font-mono",children:s.rfid}),e.jsx("td",{className:"p-2",children:s.action}),e.jsxs("td",{className:"p-2",children:["â‚±",s.amount]}),e.jsx("td",{className:"p-2",children:s.time}),e.jsxs("td",{className:"p-2",children:["â‚±",s.balance]})]},i)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-3 text-center text-gray-500 text-xs",children:"No recent prepaid events available."})})})]})]})]})]}):e.jsx("div",{children:"Checking authentication..."})};export{P as default};
