import{r as a,j as e,d as S,e as q}from"./index-BYZoeFiF.js";import{S as E}from"./StaffSidebar-CfYjULwa.js";import"./index-D-5OJeWc.js";const I=20;function T(l){const t=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),g=String(l.getDate()).padStart(2,"0"),u=String(l.getHours()).padStart(2,"0"),m=String(l.getMinutes()).padStart(2,"0"),o=String(l.getSeconds()).padStart(2,"0");return`${t}-${c}-${g} ${u}:${m}:${o}`}const L=({rfid_tag:l,staffUser:t})=>{const[c,g]=a.useState(l||""),[u,m]=a.useState(""),[o,h]=a.useState(""),[b,p]=a.useState(""),[x,j]=a.useState(""),[f,n]=a.useState(0),[v,N]=a.useState(!1),[w,k]=a.useState(!1),[i,C]=a.useState(""),[y,_]=a.useState(""),[$,F]=a.useState([]),d=(t==null?void 0:t.adminId)||(t==null?void 0:t.admin_id)||(t==null?void 0:t.userId),P=(t==null?void 0:t.name)||"";a.useEffect(()=>{if(!d)return;(async()=>{try{const{data:r}=await S.get(`/api/payment-methods/${d}`);Array.isArray(r)?F(r):Array.isArray(r.methods)&&F(r.methods)}catch(r){console.error("âŒ Failed to fetch payment methods:",r)}})()},[d]),a.useEffect(()=>{if(!c||!d)return;(async()=>{N(!0);try{const r=await S.get(`/api/session-fee?admin_id=${d}`);n(r.data.session_fee)}catch{n(0)}finally{N(!1)}})()},[c,d]);const D=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),R=s=>/^[0-9]{7,15}$/.test(s),A=async s=>{if(s.preventDefault(),!D(x)){alert("Please enter a valid email address.");return}if(!R(b)){alert("Please enter a valid mobile number (7-15 digits).");return}if(i==="Cashless"&&y.trim()===""){alert("Please enter your cashless payment reference number.");return}if(!d||!P){alert("âš ï¸ Staff info missing. Please log in again.");return}k(!0);try{const r=new Date;r.setHours(23,59,59,999);const M={guest_name:u,gender:o,rfid_tag:c,system_type:"prepaid_entry",staff_name:P,admin_id:d,mobile_number:b,email:x,expires_at:T(r),payment_method:i,cashless_reference:i==="Cashless"?y.trim():"",rfid_keyfob_fee:I};console.log("Submitting payload:",M),await S.post("/api/register-session",M),alert("Day pass session registered successfully!"),m(""),h(""),p(""),j(""),_("")}catch(r){console.error("Error registering session:",r),alert("Failed to register day pass session. Please try again.")}finally{k(!1)}};return e.jsx("div",{className:"px-6 py-8 bg-gray-100 h-screen ",children:e.jsxs("main",{className:"max-w-screen-lg",children:[e.jsx("h1",{className:"text-xl font-bold mb-6 text-black",children:"Prepaid Day Pass"}),e.jsx("form",{onSubmit:A,className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-white rounded-lg shadow",children:e.jsxs("div",{className:"md:col-span-2 flex flex-col gap-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Guest Name"}),e.jsx("input",{type:"text",value:u,onChange:s=>m(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"RFID Tag"}),e.jsx("input",{type:"text",value:c,readOnly:!0,placeholder:"Scan RFID tag",className:"w-full border border-gray-300 px-3 py-2 rounded bg-gray-100 text-black cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Email Address"}),e.jsx("input",{type:"email",value:x,onChange:s=>j(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Mobile Number"}),e.jsx("input",{type:"tel",value:b,onChange:s=>p(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Gender"}),e.jsxs("select",{value:o,onChange:s=>h(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded bg-white",children:[e.jsx("option",{value:"",disabled:!0,children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Payment Method"}),e.jsxs("select",{value:i,onChange:s=>C(s.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded bg-white",children:[e.jsx("option",{value:"",children:"Select"}),$.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})]})]}),i&&i.toLowerCase()!=="cash"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 text-black",children:[i," Reference"]}),e.jsx("input",{type:"text",value:y,onChange:s=>_(s.target.value),required:!0,placeholder:`Enter ${i} reference`,className:"w-full border border-gray-300 px-3 py-2 rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"RFID Tag Fee(â‚±)"}),e.jsx("input",{type:"number",value:I,readOnly:!0,className:"w-full border border-gray-200 bg-gray-50 px-3 py-2 rounded text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Session Fee (â‚±)"}),e.jsx("input",{type:"number",value:f,readOnly:!0,className:"w-full border border-gray-200 bg-gray-50 px-3 py-2 rounded text-black"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:w||v,className:"w-1/2 mt-2 px-5 py-2 rounded bg-black text-white font-semibold",children:w?"Submitting...":"Add Member"})})]})})]})})},O=20;function G(l){const t=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),g=String(l.getDate()).padStart(2,"0"),u=String(l.getHours()).padStart(2,"0"),m=String(l.getMinutes()).padStart(2,"0"),o=String(l.getSeconds()).padStart(2,"0");return`${t}-${c}-${g} ${u}:${m}:${o}`}const H=({rfid_tag:l,staffUser:t})=>{const[c,g]=a.useState(l||""),[u,m]=a.useState(""),[o,h]=a.useState(""),[b,p]=a.useState(""),[x,j]=a.useState(""),[f,n]=a.useState(0),[v,N]=a.useState(!1),[w,k]=a.useState(!1),[i,C]=a.useState(""),[y,_]=a.useState(""),[$,F]=a.useState([]),d=(t==null?void 0:t.adminId)||(t==null?void 0:t.admin_id)||(t==null?void 0:t.userId),P=(t==null?void 0:t.name)||"",D=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),R=s=>/^[0-9]{7,15}$/.test(s);a.useEffect(()=>{if(!d)return;(async()=>{try{const{data:r}=await S.get(`/api/payment-methods/${d}`);Array.isArray(r)?F(r):Array.isArray(r.methods)&&F(r.methods)}catch(r){console.error("âŒ Failed to fetch payment methods:",r)}})()},[d]),a.useEffect(()=>{if(!c||!d)return;(async()=>{N(!0);try{const r=await axios.get(`/api/session-fee?admin_id=${d}`);n(r.data.session_fee)}catch{n(0)}finally{N(!1)}})()},[c,d]);const A=async s=>{if(s.preventDefault(),!D(x)){alert("Please enter a valid email address.");return}if(!R(b)){alert("Please enter a valid mobile number (7-15 digits).");return}if(i==="Cashless"&&y.trim()===""){alert("Please enter your cashless payment reference number.");return}if(!d||!P){alert("âš ï¸ Staff info missing. Please log in again.");return}k(!0);try{const r=new Date;r.setHours(23,59,59,999);const M={guest_name:u,gender:o,rfid_tag:c,system_type:"subscription",staff_name:P,admin_id:d,mobile_number:b,email:x,expires_at:G(r),payment_method:i,cashless_reference:i==="Cashless"?y.trim():"",rfid_keyfob_fee:O};console.log("Submitting payload:",M),await S.post("/api/register-session",M),alert("Day pass session registered successfully!"),m(""),h(""),p(""),j(""),_("")}catch(r){console.error("Error registering session:",r),alert("Failed to register day pass session. Please try again.")}finally{k(!1)}};return e.jsx("div",{className:"px-6 py-8 bg-gray-100 h-screen",children:e.jsxs("main",{className:"max-w-screen-lg",children:[e.jsx("h1",{className:"text-xl font-bold mb-6 text-black",children:"Subscription Day Pass"}),e.jsx("form",{onSubmit:A,className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-white rounded-lg shadow",children:e.jsxs("div",{className:"md:col-span-2 flex flex-col gap-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Guest Name"}),e.jsx("input",{type:"text",value:u,onChange:s=>m(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"RFID Tag"}),e.jsx("input",{type:"text",value:c,readOnly:!0,placeholder:"Scan RFID tag",className:"w-full border border-gray-300 px-3 py-2 rounded bg-gray-100 text-black cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Email Address"}),e.jsx("input",{type:"email",value:x,onChange:s=>j(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Mobile Number"}),e.jsx("input",{type:"tel",value:b,onChange:s=>p(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Gender"}),e.jsxs("select",{value:o,onChange:s=>h(s.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded bg-white",children:[e.jsx("option",{value:"",disabled:!0,children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Payment Method"}),e.jsxs("select",{value:i,onChange:s=>C(s.target.value),className:"w-full border border-gray-300 px-3 py-2 rounded bg-white",children:[e.jsx("option",{value:"",children:"Select"}),$.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})]})]}),i&&i.toLowerCase()!=="cash"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 text-black",children:[i," Reference"]}),e.jsx("input",{type:"text",value:y,onChange:s=>_(s.target.value),required:!0,placeholder:`Enter ${i} reference`,className:"w-full border border-gray-300 px-3 py-2 rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"RFID Tag Fee(â‚±)"}),e.jsx("input",{type:"number",value:O,readOnly:!0,className:"w-full border border-gray-200 bg-gray-50 px-3 py-2 rounded text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-black",children:"Session Fee (â‚±)"}),e.jsx("input",{type:"number",value:f,readOnly:!0,className:"w-full border border-gray-200 bg-gray-50 px-3 py-2 rounded text-black"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:w||v,className:"w-1/2 mt-2 px-5 py-2 rounded bg-black text-white font-semibold",children:w?"Submitting...":"Add Member"})})]})})]})})},z=()=>{var x;const l=q(),[t,c]=a.useState(null),[g,u]=a.useState(""),[m,o]=a.useState(!0),[h,b]=a.useState(null),p=((x=l.state)==null?void 0:x.rfid_tag)||"";return a.useEffect(()=>{(async()=>{var f;try{o(!0),b(null);const{data:n}=await S.get("/api/me");if(console.log("ðŸ“¥ Staff info response:",n),!n.authenticated||!n.user)throw new Error("Not authenticated");if(n.user.role!=="staff"&&n.user.role!=="admin")throw new Error("Only staff/admin can access DayPass");c(n.user);const v=n.user.systemType||n.user.system_type||"";u(v),console.log("ðŸ” System type:",v)}catch(n){console.error("âŒ Failed to fetch staff info:",n),b(n.message||"Failed to fetch staff info"),((f=n.response)==null?void 0:f.status)===401&&(window.location.href="/login")}finally{o(!1)}})()},[]),m?e.jsxs("div",{className:"flex",children:[e.jsx(E,{}),e.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"â³"}),e.jsx("p",{className:"text-gray-600",children:"Loading DayPass system..."})]})]}):h?e.jsxs("div",{className:"flex",children:[e.jsx(E,{}),e.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âŒ"}),e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:h}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})]}):g?e.jsxs("div",{className:"flex",children:[e.jsx(E,{}),e.jsx("div",{className:"flex-1 p-4",children:g==="prepaid_entry"?e.jsx(L,{rfid_tag:p,staffUser:t}):e.jsx(H,{rfid_tag:p,staffUser:t})})]}):e.jsxs("div",{className:"flex",children:[e.jsx(E,{}),e.jsx("div",{className:"flex-1 p-6 text-center py-12 text-gray-600",children:"Unknown system type. Please contact admin."})]})};export{z as default};
