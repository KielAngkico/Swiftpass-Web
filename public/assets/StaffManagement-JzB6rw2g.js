import{r as n,j as e,A as v,g as k,d as N}from"./index-BYZoeFiF.js";import{O as _}from"./OwnerSidebar-CZ0OhogK.js";import"./index-D-5OJeWc.js";const S=({isOpen:a,onClose:m,onEmployeeAdded:p,adminId:g})=>{const[r,o]=n.useState({name:"",age:"",address:"",contact_number:"",email:"",password:""}),[l,f]=n.useState(null),[j,b]=n.useState(null),[h,x]=n.useState(!1);if(!a)return null;const i=c=>{if(c.target.type==="file"){const d=c.target.files[0];f(d),b(d?URL.createObjectURL(d):null)}else o({...r,[c.target.name]:c.target.value})},y=async c=>{c.preventDefault(),x(!0);try{const d=new FormData;for(const u in r)d.append(u,r[u]);d.append("admin_id",g),l&&d.append("profile_image",l);const s=await fetch(`${v}/api/add-employee`,{method:"POST",body:d}),t=await s.json();if(!s.ok)throw new Error(t.message||"Failed to add employee");p({user_id:t.id,...r,profile_image_url:t.profile_image_url}),o({name:"",age:"",address:"",contact_number:"",email:"",password:""}),f(null),b(null),alert("Employee added successfully!"),m()}catch(d){alert(d.message)}finally{x(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4",onClick:m,children:e.jsxs("div",{className:"bg-white p-5 rounded-md shadow-lg w-full max-w-5xl max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Add New Employee"}),e.jsx("button",{onClick:m,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsxs("div",{className:"space-y-3 md:col-span-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:i,className:"w-full p-2 border border-gray-300 rounded-md text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Age *"}),e.jsx("input",{type:"number",name:"age",value:r.age,onChange:i,className:"w-full p-2 border border-gray-300 rounded-md text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:i,className:"w-full p-2 border border-gray-300 rounded-md text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Contact Number *"}),e.jsx("input",{type:"text",name:"contact_number",value:r.contact_number,onChange:i,className:"w-full p-2 border border-gray-300 rounded-md text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Address *"}),e.jsx("textarea",{name:"address",value:r.address,onChange:i,rows:"2",className:"w-full p-2 border border-gray-300 rounded-md text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 resize-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Password *"}),e.jsx("input",{type:"password",name:"password",value:r.password,onChange:i,className:"w-full p-2 border border-gray-300 rounded-md text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-60 h-60 bg-gray-100 border rounded-md flex items-center justify-center overflow-hidden",children:j?e.jsx("img",{src:j,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})}),e.jsxs("label",{className:"cursor-pointer bg-blue-500 text-white text-xs px-4 py-2 rounded-md hover:bg-blue-600",children:["Upload Picture",e.jsx("input",{type:"file",accept:"image/*",onChange:i,className:"hidden"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 bg-gray-500 text-white px-3 py-2 rounded-md text-xs hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md text-xs disabled:opacity-50",children:h?"Adding...":"Add Employee"})]})]})]})})},P=()=>{const[a,m]=n.useState(null),[p,g]=n.useState([]),[r,o]=n.useState(!1),[l,f]=n.useState(null),[j,b]=n.useState(!0),[h,x]=n.useState(""),i=k();n.useEffect(()=>{(async()=>{try{const{data:t}=await N.get("/api/me");if(!(t!=null&&t.authenticated)||!(t!=null&&t.user))throw new Error("Not authenticated");m(t.user)}catch{i("/login")}})()},[i]),n.useEffect(()=>{if(!(a!=null&&a.id)&&!(a!=null&&a.adminId))return;(async()=>{try{b(!0);const t=a.adminId||a.id,{data:u}=await N.get(`/api/get-employees/${t}`);g(u.employees||[])}catch(t){console.error(t),x("Failed to load staff.")}finally{b(!1)}})()},[a]);const y=async(s,t)=>{if(!(!s||!window.confirm(`Delete ${t}?`)))try{await N.delete(`/api/staff/${s}`),g(u=>u.filter(w=>w.user_id!==s)),x("Staff deleted successfully!")}catch{x("Failed to delete staff.")}},c=s=>{g(t=>[...t,s]),o(!1)},d=({employee:s})=>{var t;return s!=null&&s.profile_image_url?e.jsx("img",{src:s.profile_image_url,alt:s.name||"Staff member",className:"w-20 h-20 object-cover"}):e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 text-white font-bold flex items-center justify-center text-lg",children:((t=s==null?void 0:s.name)==null?void 0:t.charAt(0).toUpperCase())||"N"})};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(_,{}),e.jsxs("main",{className:"flex-1 p-4",children:[e.jsxs("div",{className:"mb-3 p-2",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Staff Management"}),e.jsx("p",{className:"text-gray-500 text-xs",children:"Manage your team members"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1.5 rounded-md hover:bg-blue-700 transition-colors text-xs font-medium",onClick:()=>o(!0),children:"+ Add New Staff"})}),h&&e.jsx("div",{className:"p-2 mb-2 rounded border text-xs bg-red-50 border-red-200 text-red-700",children:h}),e.jsx(S,{isOpen:r,onClose:()=>o(!1),onEmployeeAdded:c,adminId:(a==null?void 0:a.adminId)||(a==null?void 0:a.id)}),j?e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-b-2 border-blue-600 rounded-full"}),e.jsx("span",{className:"ml-2 text-gray-500 text-xs",children:"Loading staff..."})]}):p.length===0?e.jsxs("div",{className:"text-center py-6 bg-white rounded border text-xs",children:[e.jsx("p",{className:"text-gray-400 mb-1",children:"No staff members found"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"Add your first staff to get started"}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-xs",onClick:()=>o(!0),children:"Add Staff"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(s=>e.jsxs("div",{className:"rounded-lg border shadow-sm hover:shadow-md transition-all text-xs bg-white flex justify-between items-center p-3",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("h3",{className:"font-bold text-black text-sm truncate",children:s.name}),e.jsx("p",{className:"text-black text-xs truncate",children:s.email||"No email"}),e.jsxs("p",{className:"text-black text-xs",children:["Age: ",s.age||"N/A"]}),e.jsxs("p",{className:"text-black text-xs",children:["Contact: ",s.contact_number||"N/A"]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"flex-1 bg-gray-100 text-gray-700 px-2 py-1 rounded hover:bg-gray-200 text-xs font-medium",onClick:()=>f(s),children:"View"}),e.jsx("button",{className:"flex-1 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs font-medium",onClick:()=>y(s.user_id,s.name),children:"Delete"})]})]}),e.jsx(d,{employee:s})]},s.user_id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-full max-w-sm shadow-lg",children:[l.profile_image_url&&e.jsx("img",{src:l.profile_image_url,alt:l.name,className:"w-full h-36 object-cover rounded mb-2"}),e.jsx("h2",{className:"text-lg font-semibold mb-1",children:l.name}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Email: ",l.email]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Age: ",l.age]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Contact: ",l.contact_number]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Address: ",l.address]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{className:"bg-gray-200 text-gray-700 px-3 py-1 rounded text-xs hover:bg-gray-300",onClick:()=>f(null),children:"Close"})})]})})]})]})};export{P as default};
