import{r as l,j as e,d as j}from"./index-BYZoeFiF.js";import{S as y}from"./StaffSidebar-CfYjULwa.js";import"./index-D-5OJeWc.js";const v=()=>{const[o,p]=l.useState([]),[x,m]=l.useState(""),[h,i]=l.useState(!1),[d,f]=l.useState(null),[s,c]=l.useState(null),[w,N]=l.useState(null);l.useRef(null),l.useEffect(()=>{(async()=>{var r,g;try{i(!0),console.log("🔍 Fetching staff info...");const{data:a}=await j.get("/api/me");if(console.log("📥 Auth response:",a),!a.authenticated||!a.user)throw new Error("Not authenticated");const n=a.user.adminId||a.user.admin_id||a.user.userId;if(console.log("🔍 Extracted adminId:",n),!n)throw new Error("Admin ID missing from user data");N(n),console.log(`🔍 Fetching members for admin ID: ${n}`);const b=await j.get(`/api/get-members?admin_id=${n}`);p(b.data.members||[]),console.log("✅ Members fetched:",((r=b.data.members)==null?void 0:r.length)||0)}catch(a){if(console.error("❌ Failed to fetch data:",a),((g=a.response)==null?void 0:g.status)===401){window.location.href="/login";return}f({message:a.message||"Failed to load data. Please try again.",type:"error"})}finally{i(!1)}})()},[]);const u=o.filter(t=>{var r;return(r=t.full_name)==null?void 0:r.toLowerCase().includes(x.toLowerCase())});return e.jsx("div",{className:"flex h-screen overflow-hidden bg-gray-100",children:e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Prepaid Members"}),d&&e.jsx("div",{className:`mb-4 p-3 rounded text-white font-semibold ${d.type==="success"?"bg-green-500":"bg-red-500"}`,children:d.message}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 w-full md:w-1/3 text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Total Members"}),e.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:o.length})]}),e.jsx("input",{type:"text",placeholder:"Search members...",className:"p-3 border border-gray-300 rounded w-full md:w-1/3",value:x,onChange:t=>m(t.target.value)})]}),h?e.jsx("p",{className:"text-gray-600",children:"Loading members..."}):u.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No members found."}):e.jsx("div",{className:"overflow-x-auto bg-white rounded shadow",children:e.jsxs("table",{className:"min-w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-800 text-white uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Profile"}),e.jsx("th",{className:"px-6 py-3",children:"Name"}),e.jsx("th",{className:"px-6 py-3",children:"Phone"}),e.jsx("th",{className:"px-6 py-3",children:"Balance"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.map((t,r)=>e.jsxs("tr",{className:r%2===0?"bg-gray-50":"bg-white",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("img",{src:`http://localhost:5000/${t.profile_image_url}`,alt:t.full_name,className:"w-10 h-10 rounded-full object-cover border"})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-800",children:t.full_name}),e.jsx("td",{className:"px-6 py-4",children:t.phone_number}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"inline-block px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700 shadow-sm",children:["₱",parseFloat(t.current_balance||0).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-full shadow-sm ${t.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>c(t),className:"px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"View"})})]},t.rfid_tag||r))})]})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-3xl mx-4 relative animate-fade-in",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold","aria-label":"Close",children:"×"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:`http://localhost:5000/${s.profile_image_url}`,alt:s.full_name,className:"w-40 h-40 object-cover border-4 border-indigo-500 shadow-md rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl font-bold text-indigo-700 mb-2",children:s.full_name}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Age:"})," ",s.age]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.phone_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Balance:"})," ",e.jsxs("span",{className:"inline-block ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700",children:["₱",parseFloat(s.current_balance||0).toFixed(2)]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:`inline-block ml-2 px-2 py-1 text-xs font-semibold rounded-full ${s.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Joined:"})," ",new Date(s.created_at).toLocaleDateString()]})]})]})]})]})})]})})},S=()=>{const[o,p]=l.useState([]),[x,m]=l.useState(""),[h,i]=l.useState(!1),[d,f]=l.useState(null),[s,c]=l.useState(null),[w,N]=l.useState(null);l.useRef(null),l.useEffect(()=>{(async()=>{var r,g;try{i(!0),console.log("🔍 Fetching staff info...");const{data:a}=await j.get("/api/me");if(console.log("📥 Auth response:",a),!a.authenticated||!a.user)throw new Error("Not authenticated");const n=a.user.adminId||a.user.admin_id||a.user.userId;if(console.log("🔍 Extracted adminId:",n),!n)throw new Error("Admin ID missing from user data");N(n),console.log(`🔍 Fetching members for admin ID: ${n}`);const b=await j.get(`/api/get-members?admin_id=${n}`);p(b.data.members||[]),console.log("✅ Members fetched:",((r=b.data.members)==null?void 0:r.length)||0)}catch(a){if(console.error("❌ Failed to fetch data:",a),((g=a.response)==null?void 0:g.status)===401){window.location.href="/login";return}f({message:a.message||"Failed to load data. Please try again.",type:"error"})}finally{i(!1)}})()},[]);const u=o.filter(t=>{var r;return(r=t.full_name)==null?void 0:r.toLowerCase().includes(x.toLowerCase())});return e.jsx("div",{className:"flex h-screen overflow-hidden bg-gray-100",children:e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Subscription Members"}),d&&e.jsx("div",{className:`mb-4 p-3 rounded text-white font-semibold ${d.type==="success"?"bg-green-500":"bg-red-500"}`,children:d.message}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 w-full md:w-1/3 text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Total Members"}),e.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:o.length})]}),e.jsx("input",{type:"text",placeholder:"Search members...",className:"p-3 border border-gray-300 rounded w-full md:w-1/3",value:x,onChange:t=>m(t.target.value)})]}),h?e.jsx("p",{className:"text-gray-600",children:"Loading members..."}):u.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No members found."}):e.jsx("div",{className:"overflow-x-auto bg-white rounded shadow",children:e.jsxs("table",{className:"min-w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-800 text-white uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"ID"}),e.jsx("th",{className:"px-4 py-3",children:"Profile"}),e.jsx("th",{className:"px-4 py-3",children:"Name"}),e.jsx("th",{className:"px-4 py-3",children:"Phone"}),e.jsx("th",{className:"px-4 py-3",children:"Subscription"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.map((t,r)=>e.jsxs("tr",{className:r%2===0?"bg-gray-50":"bg-white",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-600",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("img",{src:`http://localhost:5000/${t.profile_image_url}`,alt:t.full_name,className:"w-10 h-10 rounded-full object-cover border"})}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-800",children:t.full_name}),e.jsx("td",{className:"px-4 py-3",children:t.phone_number}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[new Date(t.subscription_start).toLocaleDateString()," →"," ",new Date(t.subscription_expiry).toLocaleDateString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${t.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>c(t),className:"px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"View"})})]},t.rfid_tag||r))})]})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-3xl mx-4 relative animate-fade-in",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold","aria-label":"Close",children:"×"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:`http://localhost:5000/${s.profile_image_url}`,alt:s.full_name,className:"w-40 h-40 rounded-full object-cover border-4 border-indigo-500 shadow-md"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl font-bold text-indigo-700 mb-2",children:s.full_name}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Age:"})," ",s.age]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.phone_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-semibold ${s.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Subscription:"})," ",new Date(s.subscription_start).toLocaleDateString()," → ",new Date(s.subscription_expiry).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Joined:"})," ",new Date(s.created_at).toLocaleDateString()]})]})]})]})]})})]})})},I=()=>{const[o,p]=l.useState(""),[x,m]=l.useState(!0),[h,i]=l.useState(null);return l.useEffect(()=>{(async()=>{var f;try{m(!0),i(null);const{data:s}=await j.get("/api/me");if(console.log("📥 Staff info response:",s),!s.authenticated||!s.user)throw new Error("Not authenticated");if(s.user.role!=="staff"&&s.user.role!=="admin")throw new Error("Only staff/admin can access this page");const c=(s.user.systemType||s.user.system_type||"").toLowerCase().trim();console.log("🔍 System type:",c),p(c)}catch(s){console.error("❌ Failed to fetch staff info:",s),i(s.message||"Failed to fetch staff info"),((f=s.response)==null?void 0:f.status)===401&&(window.location.href="/login")}finally{m(!1)}})()},[]),x?e.jsxs("div",{className:"flex",children:[e.jsx(y,{}),e.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⏳"}),e.jsx("p",{className:"text-gray-600",children:"Loading staff system..."})]})]}):h?e.jsxs("div",{className:"flex",children:[e.jsx(y,{}),e.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"❌"}),e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:h}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})]}):e.jsxs("div",{className:"flex",children:[e.jsx(y,{}),e.jsx("div",{className:"flex-1 p-4",children:o==="prepaid_entry"?e.jsx(v,{}):e.jsx(S,{})})]})};export{I as default};
