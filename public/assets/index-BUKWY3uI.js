import{r as n,j as e,d as u}from"./index-BYZoeFiF.js";import{O as E}from"./OwnerSidebar-CZ0OhogK.js";import"./index-D-5OJeWc.js";const M=()=>{const[r,N]=n.useState(null),[p,f]=n.useState([]),[j,d]=n.useState(!1),[m,h]=n.useState(null),[a,l]=n.useState({plan_name:"",amount_to_pay:"",amount_to_credit:""}),[_,o]=n.useState(!1),[x,g]=n.useState({name:"",reference_number:""}),[y,w]=n.useState([]);n.useEffect(()=>{(async()=>{var s;try{const{data:i}=await u.get("/api/me");if(console.log("📥 PrepaidPricing user:",i),!i.authenticated||!i.user)throw new Error("Not authenticated");const c=i.user.adminId||i.user.id;if(!c)throw new Error("Missing admin ID");N(c)}catch(i){console.error("❌ Failed to fetch user in PrepaidPricing:",i),((s=i.response)==null?void 0:s.status)===401&&(window.location.href="/login")}})()},[]);const b=async()=>{if(r)try{const{data:t}=await u.get(`/api/get-pricing/${r}`);f(t.filter(s=>s.system_type==="prepaid_entry"))}catch(t){console.error("❌ Failed to fetch prepaid plans:",t)}},v=async()=>{if(r)try{const{data:t}=await u.get(`/api/payment-methods/${r}`);w(t)}catch(t){console.error("❌ Failed to fetch payment methods:",t)}};n.useEffect(()=>{r&&(b(),v())},[r]);const P=async t=>{if(t.preventDefault(),!r)return;const s=m?`/api/update-pricing/${m}`:"/api/add-pricing",i=m?"put":"post";try{const{data:c}=await u[i](s,{...a,system_type:"prepaid_entry",admin_id:r});alert(c.message),l({plan_name:"",amount_to_pay:"",amount_to_credit:""}),h(null),d(!1),b()}catch(c){console.error("❌ Failed to save prepaid plan:",c)}},C=async t=>{if(t.preventDefault(),!!r)try{const{data:s}=await u.post("/api/add-payment-method",{admin_id:r,...x});alert(s.message),g({name:"",reference_number:""}),o(!1),v()}catch(s){console.error("❌ Failed to save payment method:",s)}},S=t=>{l({plan_name:t.plan_name,amount_to_pay:t.amount_to_pay,amount_to_credit:t.amount_to_credit}),h(t.id),d(!0),o(!1)},F=async t=>{if(confirm("Are you sure you want to delete this plan?"))try{const{data:s}=await u.delete(`/api/delete-pricing/${t}`);alert(s.message),b()}catch(s){console.error("❌ Failed to delete prepaid plan:",s)}};return e.jsx("div",{className:"min-h-screen flex",children:e.jsxs("div",{className:"flex-1 p-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Prepaid Pricing"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Manage pricing plans and payment methods"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-1 mb-2",children:[e.jsxs("button",{onClick:()=>{d(!0),o(!1),l({plan_name:"",amount_to_pay:"",amount_to_credit:""}),h(null)},className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded flex items-center gap-1 text-xs",children:[e.jsx("span",{className:"text-sm font-bold",children:"+"}),e.jsxs("div",{children:[e.jsx("div",{children:"Create New Plan"}),e.jsx("div",{className:"text-[9px] opacity-90",children:"Add a new plan"})]})]}),e.jsxs("button",{onClick:()=>{o(!0),d(!1),g({name:"",reference_number:""})},className:"bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 rounded flex items-center gap-1 text-xs",children:[e.jsx("span",{className:"text-sm",children:"💳"}),e.jsxs("div",{children:[e.jsx("div",{children:"Add Payment Method"}),e.jsx("div",{className:"text-[9px] opacity-90",children:"Configure options"})]})]})]}),j&&e.jsxs("div",{className:"bg-white rounded shadow p-2 relative mb-2 text-xs",children:[e.jsx("button",{onClick:()=>d(!1),className:"absolute top-1 right-1 text-gray-400 hover:text-gray-600",children:"✕"}),e.jsx("h3",{className:"font-medium mb-1",children:m?"Edit Plan":"New Plan"}),e.jsxs("form",{onSubmit:P,className:"space-y-1",children:[e.jsx("input",{type:"text",placeholder:"Plan Name",value:a.plan_name,onChange:t=>l({...a,plan_name:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-1",children:[e.jsx("input",{type:"number",placeholder:"Amount to Pay",value:a.amount_to_pay,onChange:t=>l({...a,amount_to_pay:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0}),e.jsx("input",{type:"number",placeholder:"Amount to Credit",value:a.amount_to_credit,onChange:t=>l({...a,amount_to_credit:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded",children:m?"Update":"Save"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"bg-gray-300 hover:bg-gray-400 px-2 py-1 rounded",children:"Cancel"})]})]})]}),_&&e.jsxs("div",{className:"bg-white rounded shadow p-2 relative mb-2 text-xs",children:[e.jsx("button",{onClick:()=>o(!1),className:"absolute top-1 right-1 text-gray-400 hover:text-gray-600",children:"✕"}),e.jsx("h3",{className:"font-medium mb-1",children:"Add Payment Method"}),e.jsxs("form",{onSubmit:C,className:"space-y-1",children:[e.jsx("input",{type:"text",placeholder:"Payment Method Name",value:x.name,onChange:t=>g({...x,name:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Reference Number (Optional)",value:x.reference_number,onChange:t=>g({...x,reference_number:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"bg-gray-300 hover:bg-gray-400 px-2 py-1 rounded",children:"Cancel"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-medium text-xs mb-1",children:["Current Plans (",p.length,")"]}),p.length===0?e.jsx("div",{className:"bg-white rounded shadow p-2 text-center text-gray-500 text-xs",children:"No prepaid plans yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-1",children:p.map(t=>e.jsxs("div",{className:"bg-white rounded shadow hover:shadow-md p-2 group text-xs",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"truncate",children:t.plan_name}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>S(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded text-xs",children:"✏️"}),e.jsx("button",{onClick:()=>F(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded text-xs",children:"🗑️"})]})]}),e.jsxs("div",{className:"flex justify-between mb-1 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Customer Pays"}),e.jsxs("p",{className:"font-bold",children:["₱",parseFloat(t.amount_to_pay).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Gets Credit"}),e.jsxs("p",{className:"font-bold text-blue-600",children:["₱",parseFloat(t.amount_to_credit).toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-blue-50 text-blue-700 px-1 py-0.5 rounded-full text-center text-xs",children:["+₱",(parseFloat(t.amount_to_credit)-parseFloat(t.amount_to_pay)).toFixed(2)," Bonus"]})]},t.id))})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("h2",{className:"font-medium text-xs mb-1",children:["Payment Methods (",y.length,")"]}),y.length===0?e.jsx("div",{className:"bg-white rounded shadow p-2 text-center text-gray-500 text-xs",children:"No payment methods yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-1",children:y.map(t=>e.jsx("div",{className:"bg-white rounded shadow hover:shadow-md p-2 text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 text-blue-600 rounded flex items-center justify-center text-xs",children:"💳"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate",children:t.name}),t.reference_number&&e.jsx("div",{className:"text-gray-600 truncate text-[9px]",children:t.reference_number})]})]})},t.id))})]})]})})},k=()=>{const[r,N]=n.useState(null),[p,f]=n.useState([]),[j,d]=n.useState(!1),[m,h]=n.useState(null),[a,l]=n.useState({plan_name:"",amount_to_pay:"",duration_in_days:""}),[_,o]=n.useState(!1),[x,g]=n.useState({name:"",reference_number:""}),[y,w]=n.useState([]);n.useEffect(()=>{(async()=>{var s;try{const{data:i}=await u.get("/api/me");if(!i.authenticated||!i.user)throw new Error("Not authenticated");const c=i.user.adminId||i.user.id;if(!c)throw new Error("Missing admin ID");N(c)}catch(i){console.error("❌ Failed to fetch user in SubscriptionPricing:",i),((s=i.response)==null?void 0:s.status)===401&&(window.location.href="/login")}})()},[]);const b=async()=>{if(r)try{const{data:t}=await u.get(`/api/get-pricing/${r}`);f(t.filter(s=>s.system_type==="subscription"))}catch(t){console.error("❌ Failed to fetch subscription plans:",t)}},v=async()=>{if(r)try{const{data:t}=await u.get(`/api/payment-methods/${r}`);w(t)}catch(t){console.error("❌ Failed to fetch payment methods:",t)}};n.useEffect(()=>{r&&(b(),v())},[r]);const P=async t=>{if(t.preventDefault(),!r)return;const s=m?`/api/update-pricing/${m}`:"/api/add-pricing",i=m?"put":"post";try{const{data:c}=await u[i](s,{...a,system_type:"subscription",admin_id:r});alert(c.message),l({plan_name:"",amount_to_pay:"",duration_in_days:""}),h(null),d(!1),b()}catch(c){console.error("❌ Failed to save subscription plan:",c)}},C=async t=>{if(t.preventDefault(),!!r)try{const{data:s}=await u.post("/api/add-payment-method",{admin_id:r,...x});alert(s.message),g({name:"",reference_number:""}),o(!1),v()}catch(s){console.error("❌ Failed to save payment method:",s)}},S=t=>{l({plan_name:t.plan_name,amount_to_pay:t.amount_to_pay,duration_in_days:t.duration_in_days}),h(t.id),d(!0),o(!1)},F=async t=>{if(confirm("Are you sure you want to delete this plan?"))try{const{data:s}=await u.delete(`/api/delete-pricing/${t}`);alert(s.message),b()}catch(s){console.error("❌ Failed to delete subscription plan:",s)}};return e.jsx("div",{className:"min-h-screen flex",children:e.jsxs("div",{className:"flex-1 p-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Subscription Pricing"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Manage subscription plans and payment methods"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-1 mb-2",children:[e.jsxs("button",{onClick:()=>{d(!0),o(!1),l({plan_name:"",amount_to_pay:"",duration_in_days:""}),h(null)},className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded flex items-center gap-1 text-xs",children:[e.jsx("span",{className:"text-sm font-bold",children:"+"}),e.jsxs("div",{children:[e.jsx("div",{children:"Create New Plan"}),e.jsx("div",{className:"text-[9px] opacity-90",children:"Add a new plan"})]})]}),e.jsxs("button",{onClick:()=>{o(!0),d(!1),g({name:"",reference_number:""})},className:"bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 rounded flex items-center gap-1 text-xs",children:[e.jsx("span",{className:"text-sm",children:"💳"}),e.jsxs("div",{children:[e.jsx("div",{children:"Add Payment Method"}),e.jsx("div",{className:"text-[9px] opacity-90",children:"Configure options"})]})]})]}),j&&e.jsxs("div",{className:"bg-white rounded shadow p-2 relative mb-2 text-xs",children:[e.jsx("button",{onClick:()=>d(!1),className:"absolute top-1 right-1 text-gray-400 hover:text-gray-600",children:"✕"}),e.jsx("h3",{className:"font-medium mb-1",children:m?"Edit Plan":"New Plan"}),e.jsxs("form",{onSubmit:P,className:"space-y-1",children:[e.jsx("input",{type:"text",placeholder:"Plan Name",value:a.plan_name,onChange:t=>l({...a,plan_name:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-1",children:[e.jsx("input",{type:"number",placeholder:"Amount to Pay",value:a.amount_to_pay,onChange:t=>l({...a,amount_to_pay:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0}),e.jsx("input",{type:"number",placeholder:"Duration (Days)",value:a.duration_in_days,onChange:t=>l({...a,duration_in_days:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded",children:m?"Update":"Save"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"bg-gray-300 hover:bg-gray-400 px-2 py-1 rounded",children:"Cancel"})]})]})]}),_&&e.jsxs("div",{className:"bg-white rounded shadow p-2 relative mb-2 text-xs",children:[e.jsx("button",{onClick:()=>o(!1),className:"absolute top-1 right-1 text-gray-400 hover:text-gray-600",children:"✕"}),e.jsx("h3",{className:"font-medium mb-1",children:"Add Payment Method"}),e.jsxs("form",{onSubmit:C,className:"space-y-1",children:[e.jsx("input",{type:"text",placeholder:"Payment Method Name",value:x.name,onChange:t=>g({...x,name:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Reference Number (Optional)",value:x.reference_number,onChange:t=>g({...x,reference_number:t.target.value}),className:"w-full p-1 border rounded focus:ring-1 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"bg-gray-300 hover:bg-gray-400 px-2 py-1 rounded",children:"Cancel"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-medium text-xs mb-1",children:["Current Plans (",p.length,")"]}),p.length===0?e.jsx("div",{className:"bg-white rounded shadow p-2 text-center text-gray-500 text-xs",children:"No subscription plans yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-1",children:p.map(t=>e.jsxs("div",{className:"bg-white rounded shadow hover:shadow-md p-2 group text-xs",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"truncate",children:t.plan_name}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>S(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded text-xs",children:"✏️"}),e.jsx("button",{onClick:()=>F(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded text-xs",children:"🗑️"})]})]}),e.jsxs("div",{className:"flex justify-between mb-1 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Customer Pays"}),e.jsxs("p",{className:"font-bold",children:["₱",parseFloat(t.amount_to_pay).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Duration"}),e.jsxs("p",{className:"font-bold text-blue-600",children:[t.duration_in_days," day",t.duration_in_days>1?"s":""]})]})]}),e.jsxs("div",{className:"bg-blue-50 text-blue-700 px-1 py-0.5 rounded-full text-center text-xs",children:[t.duration_in_days," day",t.duration_in_days>1?"s":""," access"]})]},t.id))})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("h2",{className:"font-medium text-xs mb-1",children:["Payment Methods (",y.length,")"]}),y.length===0?e.jsx("div",{className:"bg-white rounded shadow p-2 text-center text-gray-500 text-xs",children:"No payment methods yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-1",children:y.map(t=>e.jsx("div",{className:"bg-white rounded shadow hover:shadow-md p-2 text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 text-blue-600 rounded flex items-center justify-center text-xs",children:"💳"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate",children:t.name}),t.reference_number&&e.jsx("div",{className:"text-gray-600 truncate text-[9px]",children:t.reference_number})]})]})},t.id))})]})]})})},U=()=>{const[r,N]=n.useState(""),[p,f]=n.useState(!0),[j,d]=n.useState(null);return n.useEffect(()=>{(async()=>{var h;try{f(!0),d(null);const{data:a}=await u.get("/api/me");if(console.log("📥 Pricing user info:",a),!a.authenticated||!a.user)throw new Error("Not authenticated");const l=a.user.systemType||a.user.system_type||"";N(l)}catch(a){console.error("❌ Failed to fetch pricing user:",a),d(a.message||"Failed to fetch pricing user"),((h=a.response)==null?void 0:h.status)===401&&(window.location.href="/login")}finally{f(!1)}})()},[]),p?e.jsx("div",{className:"p-4 text-gray-600",children:"Loading user info..."}):j?e.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",j]}):e.jsxs("div",{className:"flex",children:[e.jsx(E,{}),e.jsx("div",{className:"flex-1 p-4",children:r==="prepaid_entry"?e.jsx(M,{}):r==="subscription"?e.jsx(k,{}):e.jsx("div",{className:"text-gray-600",children:"Unknown system type. Please contact support."})})]})};export{U as default};
