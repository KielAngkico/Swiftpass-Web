import{r as y,j as n,d as P}from"./index-BYZoeFiF.js";import{O as T}from"./OwnerSidebar-CZ0OhogK.js";import{m as R,r as m,v as xe,c as Y,i as M,t as fe,d as ve,a as me,A as W,P as H,B as pe,b as ye,e as be,L as q,f as J,C as V,g as Q,h as Z,j as ee,p as te,k as ae,l as ge}from"./index-CI_pAut9.js";import"./index-D-5OJeWc.js";/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var U=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e)return(e.deviceXDPI||1)/(e.logicalXDPI||1)}return 1}(),E={toTextLines:function(e){var r=[],t;for(e=[].concat(e);e.length;)t=e.pop(),typeof t=="string"?r.unshift.apply(r,t.split(`
`)):Array.isArray(t)?e.push.apply(e,t):M(e)||r.unshift(""+t);return r},textSize:function(e,r,t){var a=[].concat(r),s=a.length,i=e.font,l=0,o;for(e.font=t.string,o=0;o<s;++o)l=Math.max(e.measureText(a[o]).width,l);return e.font=i,{height:s*t.lineHeight,width:l}},bound:function(e,r,t){return Math.max(e,Math.min(r,t))},arrayDiff:function(e,r){var t=e.slice(),a=[],s,i,l,o;for(s=0,l=r.length;s<l;++s)o=r[s],i=t.indexOf(o),i===-1?a.push([o,1]):t.splice(i,1);for(s=0,l=t.length;s<l;++s)a.push([t[s],-1]);return a},rasterize:function(e){return Math.round(e*U)/U}};function O(e,r){var t=r.x,a=r.y;if(t===null)return{x:0,y:-1};if(a===null)return{x:1,y:0};var s=e.x-t,i=e.y-a,l=Math.sqrt(s*s+i*i);return{x:l?s/l:0,y:l?i/l:-1}}function _e(e,r,t,a,s){switch(s){case"center":t=a=0;break;case"bottom":t=0,a=1;break;case"right":t=1,a=0;break;case"left":t=-1,a=0;break;case"top":t=0,a=-1;break;case"start":t=-t,a=-a;break;case"end":break;default:s*=Math.PI/180,t=Math.cos(s),a=Math.sin(s);break}return{x:e,y:r,vx:t,vy:a}}var je=0,re=1,se=2,ie=4,ne=8;function I(e,r,t){var a=je;return e<t.left?a|=re:e>t.right&&(a|=se),r<t.top?a|=ne:r>t.bottom&&(a|=ie),a}function we(e,r){for(var t=e.x0,a=e.y0,s=e.x1,i=e.y1,l=I(t,a,r),o=I(s,i,r),c,d,u;!(!(l|o)||l&o);)c=l||o,c&ne?(d=t+(s-t)*(r.top-a)/(i-a),u=r.top):c&ie?(d=t+(s-t)*(r.bottom-a)/(i-a),u=r.bottom):c&se?(u=a+(i-a)*(r.right-t)/(s-t),d=r.right):c&re&&(u=a+(i-a)*(r.left-t)/(s-t),d=r.left),c===l?(t=d,a=u,l=I(t,a,r)):(s=d,i=u,o=I(s,i,r));return{x0:t,x1:s,y0:a,y1:i}}function $(e,r){var t=r.anchor,a=e,s,i;return r.clamp&&(a=we(a,r.area)),t==="start"?(s=a.x0,i=a.y0):t==="end"?(s=a.x1,i=a.y1):(s=(a.x0+a.x1)/2,i=(a.y0+a.y1)/2),_e(s,i,e.vx,e.vy,r.align)}var L={arc:function(e,r){var t=(e.startAngle+e.endAngle)/2,a=Math.cos(t),s=Math.sin(t),i=e.innerRadius,l=e.outerRadius;return $({x0:e.x+a*i,y0:e.y+s*i,x1:e.x+a*l,y1:e.y+s*l,vx:a,vy:s},r)},point:function(e,r){var t=O(e,r.origin),a=t.x*e.options.radius,s=t.y*e.options.radius;return $({x0:e.x-a,y0:e.y-s,x1:e.x+a,y1:e.y+s,vx:t.x,vy:t.y},r)},bar:function(e,r){var t=O(e,r.origin),a=e.x,s=e.y,i=0,l=0;return e.horizontal?(a=Math.min(e.x,e.base),i=Math.abs(e.base-e.x)):(s=Math.min(e.y,e.base),l=Math.abs(e.base-e.y)),$({x0:a,y0:s+l,x1:a+i,y1:s,vx:t.x,vy:t.y},r)},fallback:function(e,r){var t=O(e,r.origin);return $({x0:e.x,y0:e.y,x1:e.x+(e.width||0),y1:e.y+(e.height||0),vx:t.x,vy:t.y},r)}},w=E.rasterize;function Ne(e){var r=e.borderWidth||0,t=e.padding,a=e.size.height,s=e.size.width,i=-s/2,l=-a/2;return{frame:{x:i-t.left-r,y:l-t.top-r,w:s+t.width+r*2,h:a+t.height+r*2},text:{x:i,y:l,w:s,h:a}}}function ke(e,r){var t=r.chart.getDatasetMeta(r.datasetIndex).vScale;if(!t)return null;if(t.xCenter!==void 0&&t.yCenter!==void 0)return{x:t.xCenter,y:t.yCenter};var a=t.getBasePixel();return e.horizontal?{x:a,y:null}:{x:null,y:a}}function Ae(e){return e instanceof W?L.arc:e instanceof H?L.point:e instanceof pe?L.bar:L.fallback}function Se(e,r,t,a,s,i){var l=Math.PI/2;if(i){var o=Math.min(i,s/2,a/2),c=r+o,d=t+o,u=r+a-o,h=t+s-o;e.moveTo(r,d),c<u&&d<h?(e.arc(c,d,o,-Math.PI,-l),e.arc(u,d,o,-l,0),e.arc(u,h,o,0,l),e.arc(c,h,o,l,Math.PI)):c<u?(e.moveTo(c,t),e.arc(u,d,o,-l,l),e.arc(c,d,o,l,Math.PI+l)):d<h?(e.arc(c,d,o,-Math.PI,0),e.arc(c,h,o,0,Math.PI)):e.arc(c,d,o,-Math.PI,Math.PI),e.closePath(),e.moveTo(r,t)}else e.rect(r,t,a,s)}function Me(e,r,t){var a=t.backgroundColor,s=t.borderColor,i=t.borderWidth;!a&&(!s||!i)||(e.beginPath(),Se(e,w(r.x)+i/2,w(r.y)+i/2,w(r.w)-i,w(r.h)-i,t.borderRadius),e.closePath(),a&&(e.fillStyle=a,e.fill()),s&&i&&(e.strokeStyle=s,e.lineWidth=i,e.lineJoin="miter",e.stroke()))}function Ee(e,r,t){var a=t.lineHeight,s=e.w,i=e.x,l=e.y+a/2;return r==="center"?i+=s/2:(r==="end"||r==="right")&&(i+=s),{h:a,w:s,x:i,y:l}}function Ce(e,r,t){var a=e.shadowBlur,s=t.stroked,i=w(t.x),l=w(t.y),o=w(t.w);s&&e.strokeText(r,i,l,o),t.filled&&(a&&s&&(e.shadowBlur=0),e.fillText(r,i,l,o),a&&s&&(e.shadowBlur=a))}function Pe(e,r,t,a){var s=a.textAlign,i=a.color,l=!!i,o=a.font,c=r.length,d=a.textStrokeColor,u=a.textStrokeWidth,h=d&&u,b;if(!(!c||!l&&!h))for(t=Ee(t,s,o),e.font=o.string,e.textAlign=s,e.textBaseline="middle",e.shadowBlur=a.textShadowBlur,e.shadowColor=a.textShadowColor,l&&(e.fillStyle=i),h&&(e.lineJoin="round",e.lineWidth=u,e.strokeStyle=d),b=0,c=r.length;b<c;++b)Ce(e,r[b],{stroked:h,filled:l,w:t.w,x:t.x,y:t.y+t.h*b})}var le=function(e,r,t,a){var s=this;s._config=e,s._index=a,s._model=null,s._rects=null,s._ctx=r,s._el=t};R(le.prototype,{_modelize:function(e,r,t,a){var s=this,i=s._index,l=fe(m([t.font,{}],a,i)),o=m([t.color,ve.color],a,i);return{align:m([t.align,"center"],a,i),anchor:m([t.anchor,"center"],a,i),area:a.chart.chartArea,backgroundColor:m([t.backgroundColor,null],a,i),borderColor:m([t.borderColor,null],a,i),borderRadius:m([t.borderRadius,0],a,i),borderWidth:m([t.borderWidth,0],a,i),clamp:m([t.clamp,!1],a,i),clip:m([t.clip,!1],a,i),color:o,display:e,font:l,lines:r,offset:m([t.offset,4],a,i),opacity:m([t.opacity,1],a,i),origin:ke(s._el,a),padding:me(m([t.padding,4],a,i)),positioner:Ae(s._el),rotation:m([t.rotation,0],a,i)*(Math.PI/180),size:E.textSize(s._ctx,r,l),textAlign:m([t.textAlign,"start"],a,i),textShadowBlur:m([t.textShadowBlur,0],a,i),textShadowColor:m([t.textShadowColor,o],a,i),textStrokeColor:m([t.textStrokeColor,o],a,i),textStrokeWidth:m([t.textStrokeWidth,0],a,i)}},update:function(e){var r=this,t=null,a=null,s=r._index,i=r._config,l,o,c,d=m([i.display,!0],e,s);d&&(l=e.dataset.data[s],o=xe(Y(i.formatter,[l,e]),l),c=M(o)?[]:E.toTextLines(o),c.length&&(t=r._modelize(d,c,i,e),a=Ne(t))),r._model=t,r._rects=a},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(e,r){var t=this,a=e.ctx,s=t._model,i=t._rects,l;this.visible()&&(a.save(),s.clip&&(l=s.area,a.beginPath(),a.rect(l.left,l.top,l.right-l.left,l.bottom-l.top),a.clip()),a.globalAlpha=E.bound(0,s.opacity,1),a.translate(w(r.x),w(r.y)),a.rotate(s.rotation),Me(a,i.frame,s),Pe(a,s.lines,i.text,s),a.restore())}});var Re=Number.MIN_SAFE_INTEGER||-9007199254740991,Te=Number.MAX_SAFE_INTEGER||9007199254740991;function S(e,r,t){var a=Math.cos(t),s=Math.sin(t),i=r.x,l=r.y;return{x:i+a*(e.x-i)-s*(e.y-l),y:l+s*(e.x-i)+a*(e.y-l)}}function G(e,r){var t=Te,a=Re,s=r.origin,i,l,o,c,d;for(i=0;i<e.length;++i)l=e[i],o=l.x-s.x,c=l.y-s.y,d=r.vx*o+r.vy*c,t=Math.min(t,d),a=Math.max(a,d);return{min:t,max:a}}function D(e,r){var t=r.x-e.x,a=r.y-e.y,s=Math.sqrt(t*t+a*a);return{vx:(r.x-e.x)/s,vy:(r.y-e.y)/s,origin:e,ln:s}}var oe=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};R(oe.prototype,{center:function(){var e=this._rect;return{x:e.x+e.w/2,y:e.y+e.h/2}},update:function(e,r,t){this._rotation=t,this._rect={x:r.x+e.x,y:r.y+e.y,w:r.w,h:r.h}},contains:function(e){var r=this,t=1,a=r._rect;return e=S(e,r.center(),-r._rotation),!(e.x<a.x-t||e.y<a.y-t||e.x>a.x+a.w+t*2||e.y>a.y+a.h+t*2)},intersects:function(e){var r=this._points(),t=e._points(),a=[D(r[0],r[1]),D(r[0],r[3])],s,i,l;for(this._rotation!==e._rotation&&a.push(D(t[0],t[1]),D(t[0],t[3])),s=0;s<a.length;++s)if(i=G(r,a[s]),l=G(t,a[s]),i.max<l.min||l.max<i.min)return!1;return!0},_points:function(){var e=this,r=e._rect,t=e._rotation,a=e.center();return[S({x:r.x,y:r.y},a,t),S({x:r.x+r.w,y:r.y},a,t),S({x:r.x+r.w,y:r.y+r.h},a,t),S({x:r.x,y:r.y+r.h},a,t)]}});function de(e,r,t){var a=r.positioner(e,r),s=a.vx,i=a.vy;if(!s&&!i)return{x:a.x,y:a.y};var l=t.w,o=t.h,c=r.rotation,d=Math.abs(l/2*Math.cos(c))+Math.abs(o/2*Math.sin(c)),u=Math.abs(l/2*Math.sin(c))+Math.abs(o/2*Math.cos(c)),h=1/Math.max(Math.abs(s),Math.abs(i));return d*=s*h,u*=i*h,d+=r.offset*s,u+=r.offset*i,{x:a.x+d,y:a.y+u}}function Ie(e,r){var t,a,s,i;for(t=e.length-1;t>=0;--t)for(s=e[t].$layout,a=t-1;a>=0&&s._visible;--a)i=e[a].$layout,i._visible&&s._box.intersects(i._box)&&r(s,i);return e}function $e(e){var r,t,a,s,i,l,o;for(r=0,t=e.length;r<t;++r)a=e[r],s=a.$layout,s._visible&&(o=new Proxy(a._el,{get:(c,d)=>c.getProps([d],!0)[d]}),i=a.geometry(),l=de(o,a.model(),i),s._box.update(l,i,a.rotation()));return Ie(e,function(c,d){var u=c._hidable,h=d._hidable;u&&h||h?d._visible=!1:u&&(c._visible=!1)})}var C={prepare:function(e){var r=[],t,a,s,i,l;for(t=0,s=e.length;t<s;++t)for(a=0,i=e[t].length;a<i;++a)l=e[t][a],r.push(l),l.$layout={_box:new oe,_hidable:!1,_visible:!0,_set:t,_idx:l._index};return r.sort(function(o,c){var d=o.$layout,u=c.$layout;return d._idx===u._idx?u._set-d._set:u._idx-d._idx}),this.update(r),r},update:function(e){var r=!1,t,a,s,i,l;for(t=0,a=e.length;t<a;++t)s=e[t],i=s.model(),l=s.$layout,l._hidable=i&&i.display==="auto",l._visible=s.visible(),r|=l._hidable;r&&$e(e)},lookup:function(e,r){var t,a;for(t=e.length-1;t>=0;--t)if(a=e[t].$layout,a&&a._visible&&a._box.contains(r))return e[t];return null},draw:function(e,r){var t,a,s,i,l,o;for(t=0,a=r.length;t<a;++t)s=r[t],i=s.$layout,i._visible&&(l=s.geometry(),o=de(s._el,s.model(),l),i._box.update(o,l,s.rotation()),s.draw(e,o))}},Le=function(e){if(M(e))return null;var r=e,t,a,s;if(ye(e))if(!M(e.label))r=e.label;else if(!M(e.r))r=e.r;else for(r="",t=Object.keys(e),s=0,a=t.length;s<a;++s)r+=(s!==0?", ":"")+t[s]+": "+e[t[s]];return""+r},De={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:Le,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},g="$datalabels",ce="$default";function Be(e,r){var t=e.datalabels,a={},s=[],i,l;return t===!1?null:(t===!0&&(t={}),r=R({},[r,t]),i=r.labels||{},l=Object.keys(i),delete r.labels,l.length?l.forEach(function(o){i[o]&&s.push(R({},[r,i[o],{_key:o}]))}):s.push(r),a=s.reduce(function(o,c){return be(c.listeners||{},function(d,u){o[u]=o[u]||{},o[u][c._key||ce]=d}),delete c.listeners,o},{}),{labels:s,listeners:a})}function z(e,r,t,a){if(r){var s=t.$context,i=t.$groups,l;r[i._set]&&(l=r[i._set][i._key],l&&Y(l,[s,a])===!0&&(e[g]._dirty=!0,t.update(s)))}}function Fe(e,r,t,a,s){var i,l;!t&&!a||(t?a?t!==a&&(l=i=!0):l=!0:i=!0,l&&z(e,r.leave,t,s),i&&z(e,r.enter,a,s))}function Oe(e,r){var t=e[g],a=t._listeners,s,i;if(!(!a.enter&&!a.leave)){if(r.type==="mousemove")i=C.lookup(t._labels,r);else if(r.type!=="mouseout")return;s=t._hovered,t._hovered=i,Fe(e,a,s,i,r)}}function ze(e,r){var t=e[g],a=t._listeners.click,s=a&&C.lookup(t._labels,r);s&&z(e,a,s,r)}var ue={id:"datalabels",defaults:De,beforeInit:function(e){e[g]={_actives:[]}},beforeUpdate:function(e){var r=e[g];r._listened=!1,r._listeners={},r._datasets=[],r._labels=[]},afterDatasetUpdate:function(e,r,t){var a=r.index,s=e[g],i=s._datasets[a]=[],l=e.isDatasetVisible(a),o=e.data.datasets[a],c=Be(o,t),d=r.meta.data||[],u=e.ctx,h,b,N,k,j,v,p,f;for(u.save(),h=0,N=d.length;h<N;++h)if(p=d[h],p[g]=[],l&&p&&e.getDataVisibility(h)&&!p.skip)for(b=0,k=c.labels.length;b<k;++b)j=c.labels[b],v=j._key,f=new le(j,u,p,h),f.$groups={_set:a,_key:v||ce},f.$context={active:!1,chart:e,dataIndex:h,dataset:o,datasetIndex:a},f.update(f.$context),p[g].push(f),i.push(f);u.restore(),R(s._listeners,c.listeners,{merger:function(x,_,A){_[x]=_[x]||{},_[x][r.index]=A[x],s._listened=!0}})},afterUpdate:function(e){e[g]._labels=C.prepare(e[g]._datasets)},afterDatasetsDraw:function(e){C.draw(e,e[g]._labels)},beforeEvent:function(e,r){if(e[g]._listened){var t=r.event;switch(t.type){case"mousemove":case"mouseout":Oe(e,t);break;case"click":ze(e,t);break}}},afterEvent:function(e){var r=e[g],t=r._actives,a=r._actives=e.getActiveElements(),s=E.arrayDiff(t,a),i,l,o,c,d,u,h;for(i=0,l=s.length;i<l;++i)if(d=s[i],d[1])for(h=d[0].element[g]||[],o=0,c=h.length;o<c;++o)u=h[o],u.$context.active=d[1]===1,u.update(u.$context);(r._dirty||s.length)&&(C.update(r._labels),e.render()),delete r._dirty}};V.register(Q,Z,H,ee,W,te,ae,ue);const We=()=>{var N,k,j,v,p;const[e,r]=y.useState(null),[t,a]=y.useState(null),[s,i]=y.useState("all"),[l,o]=y.useState(!0),[c,d]=y.useState(null);if(y.useEffect(()=>{(async()=>{try{o(!0);const{data:x}=await P.get("/api/me");if(!x.authenticated||!x.user)throw new Error("Not authenticated");if(!["admin","owner"].includes(x.user.role))throw new Error("Access denied");r(x.user)}catch(x){d(x.message||"Failed to authenticate")}finally{o(!1)}})()},[]),y.useEffect(()=>{if(!(e!=null&&e.adminId))return;(async()=>{try{o(!0);const{data:x}=await P.get("/api/prepaid-analytics",{params:{admin_id:e.adminId,range:s}});a(x)}catch{d("Failed to load prepaid analytics")}finally{o(!1)}})()},[e,s]),l)return n.jsx("div",{className:"p-2 text-gray-600",children:"Loading..."});if(c)return n.jsx("div",{className:"p-2 text-red-600",children:c});if(!t)return n.jsx("div",{className:"p-2 text-gray-600",children:"No data available."});const u={labels:((N=t.scans_by_hour)==null?void 0:N.map(f=>`${f.hour}:00`))||[],datasets:[{label:"Prepaid Logins",data:((k=t.scans_by_hour)==null?void 0:k.map(f=>f.count))||[],borderColor:"#4F46E5",backgroundColor:"rgba(79, 70, 229, 0.2)",tension:.4,fill:!0}]},h={labels:["Top-Ups","Session Deductions"],datasets:[{data:[((j=t.topups_vs_deductions)==null?void 0:j.topups)||0,((v=t.topups_vs_deductions)==null?void 0:v.deductions)||0],backgroundColor:["#10B981","#F59E0B"]}]},b={maintainAspectRatio:!1,plugins:{datalabels:{formatter:(f,x)=>{const _=x.chart.data.datasets[0].data.reduce((A,he)=>A+he,0);return _>0?`${(f/_*100).toFixed(1)}%`:"0.0%"},color:"#fff",font:{weight:"bold",size:12}},legend:{position:"top"}}};return n.jsxs("div",{className:"p-2 flex flex-col space-y-3 w-full min-h-screen",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-1",children:[n.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Prepaid Analytical Dashboard"}),n.jsxs("select",{value:s,onChange:f=>i(f.target.value),className:"px-2 py-1 w-full sm:w-32 border border-gray-300 rounded-md text-xs text-gray-700 focus:outline-none focus:ring-1 focus:ring-indigo-500",children:[n.jsx("option",{value:"today",children:"Today"}),n.jsx("option",{value:"yesterday",children:"Yesterday"}),n.jsx("option",{value:"last-7-days",children:"Last 7 Days"})]})]}),n.jsx("p",{className:"text-gray-500 text-[11px]",children:"Overview of prepaid logins, revenue, and activity trends"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:[n.jsx(B,{title:"Active Members Inside",value:t.active_members_inside,color:"text-blue-600"}),n.jsx(B,{title:"Prepaid Revenue Today",value:`â‚±${Number((t==null?void 0:t.prepaid_revenue_today)??0).toLocaleString()}`,color:"text-green-600"}),n.jsx(B,{title:"Total Prepaid Logins",value:Number((t==null?void 0:t.total_logins_today)??0),color:"text-purple-600"}),n.jsx(B,{title:"Peak Hour",value:t.peak_hour,color:"text-gray-700"})]}),n.jsxs("div",{className:"flex flex-col lg:flex-row gap-2",children:[n.jsx("div",{className:"flex-1",children:n.jsx(X,{title:"Login Trends by Hour",children:n.jsx(q,{data:u,options:{maintainAspectRatio:!1}})})}),n.jsx("div",{className:"lg:w-1/3 w-full",children:n.jsx(X,{title:"Top-Up vs Session Breakdown",children:n.jsx(J,{data:h,options:b})})})]}),n.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm max-h-[18rem] overflow-y-auto",children:[n.jsx("h2",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Recent Prepaid Events"}),n.jsxs("table",{className:"w-full text-[11px] border-collapse",children:[n.jsx("thead",{className:"bg-gray-700 text-white sticky top-0",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-1 w-6 text-center",children:"#"}),n.jsx("th",{className:"p-1 text-left",children:"Member"}),n.jsx("th",{className:"p-1",children:"Action"}),n.jsx("th",{className:"p-1",children:"Amount"}),n.jsx("th",{className:"p-1",children:"Time"}),n.jsx("th",{className:"p-1",children:"Balance After"})]})}),n.jsx("tbody",{children:(p=t==null?void 0:t.recent_events)!=null&&p.length?t.recent_events.map((f,x)=>n.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[n.jsx("td",{className:"p-1 text-center text-gray-500",children:x+1}),n.jsx("td",{className:"p-1",children:f.name}),n.jsx("td",{className:"p-1",children:f.action}),n.jsxs("td",{className:"p-1",children:["â‚±",f.amount]}),n.jsx("td",{className:"p-1",children:f.time}),n.jsxs("td",{className:"p-1",children:["â‚±",f.balance]})]},x)):n.jsx("tr",{children:n.jsx("td",{colSpan:"7",className:"p-2 text-center text-gray-500 text-xs",children:"No recent prepaid events available."})})})]})]})]})},B=({title:e,value:r,color:t})=>n.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm",children:[n.jsx("h2",{className:"text-xs text-gray-500",children:e}),n.jsx("p",{className:`text-lg font-bold ${t}`,children:r})]}),X=({title:e,children:r})=>n.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm",children:[n.jsx("h2",{className:"text-sm font-semibold text-gray-800 mb-1",children:e}),n.jsx("div",{className:"w-full h-52 sm:h-64",children:r})]});V.register(Q,Z,H,ee,W,te,ae,ue,ge);const He=()=>{var h,b,N,k,j;const[e,r]=y.useState(null),[t,a]=y.useState(!0),[s,i]=y.useState("today"),[l,o]=y.useState(null);if(y.useEffect(()=>{(async()=>{var p,f;try{a(!0);const{data:x}=await P.get("/api/me");if(!(x!=null&&x.authenticated)||!(x!=null&&x.user))return;const _=((p=x.user)==null?void 0:p.adminId)||((f=x.user)==null?void 0:f.id);if(!_)return;o(_);const{data:A}=await P.get("/api/prepaid-activity-analytics",{params:{admin_id:_,range:s,system_type:"subscription"}});r(A)}catch(x){console.error("âŒ Error fetching subscription analytics:",x)}finally{a(!1)}})()},[s]),t||!e)return n.jsx("div",{className:"p-6 text-gray-600",children:"Loading subscription analytics..."});const c={labels:((h=e==null?void 0:e.scans_by_hour)==null?void 0:h.map(v=>`${v.hour}:00`))||[],datasets:[{label:"Subscription Logins",data:((b=e==null?void 0:e.scans_by_hour)==null?void 0:b.map(v=>v.count))||[],borderColor:"#4F46E5",backgroundColor:"rgba(79, 70, 229, 0.2)",tension:.4,fill:!0}]},d={labels:["New Memberships","Renewals"],datasets:[{data:[((N=e==null?void 0:e.topups_vs_deductions)==null?void 0:N.deductions)||0,((k=e==null?void 0:e.topups_vs_deductions)==null?void 0:k.topups)||0],backgroundColor:["#10B981","#F59E0B"]}]},u={maintainAspectRatio:!1,plugins:{datalabels:{formatter:(v,p)=>{const f=p.chart.data.datasets[0].data.reduce((_,A)=>_+A,0);return`${f>0?(v/f*100).toFixed(1):"0.0"}%`},color:"#fff",font:{weight:"bold",size:12}},legend:{position:"top"}}};return n.jsxs("div",{className:"p-2 flex flex-col space-y-3 w-full min-h-screen",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-1",children:[n.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Subscription Analytical Dashboard"}),n.jsxs("select",{value:s,onChange:v=>i(v.target.value),className:"px-2 py-1 w-full sm:w-32 border border-gray-300 rounded-md text-xs text-gray-700 focus:outline-none focus:ring-1 focus:ring-indigo-500",children:[n.jsx("option",{value:"today",children:"Today"}),n.jsx("option",{value:"yesterday",children:"Yesterday"}),n.jsx("option",{value:"last-7-days",children:"Last 7 Days"})]})]}),n.jsx("p",{className:"text-gray-500 text-[11px]",children:"Overview of subscription logins, revenue, and activity trends"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:[n.jsx(F,{title:"Active Members Inside",value:e.active_members_inside,color:"text-blue-600"}),n.jsx(F,{title:"Subscription Revenue Today",value:`â‚±${Number((e==null?void 0:e.prepaid_revenue_today)??0).toLocaleString()}`,color:"text-green-600"}),n.jsx(F,{title:"Total Subscription Logins",value:Number((e==null?void 0:e.total_logins_today)??0),color:"text-purple-600"}),n.jsx(F,{title:"Peak Hour",value:e.peak_hour,color:"text-gray-700"})]}),n.jsxs("div",{className:"flex flex-col lg:flex-row gap-2",children:[n.jsx("div",{className:"flex-1",children:n.jsx(K,{title:"Login Trends by Hour",children:n.jsx(q,{data:c,options:{maintainAspectRatio:!1}})})}),n.jsx("div",{className:"lg:w-1/3 w-full",children:n.jsx(K,{title:"New vs Renewal Breakdown",children:n.jsx(J,{data:d,options:u})})})]}),n.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm max-h-[18rem] overflow-y-auto",children:[n.jsx("h2",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Recent Subscription Events"}),n.jsxs("table",{className:"w-full text-[11px] border-collapse",children:[n.jsx("thead",{className:"bg-gray-700 text-white sticky top-0",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-1 w-6 text-center",children:"#"}),n.jsx("th",{className:"p-1 text-left",children:"Member"}),n.jsx("th",{className:"p-1",children:"RFID"}),n.jsx("th",{className:"p-1",children:"Action"}),n.jsx("th",{className:"p-1",children:"Amount"}),n.jsx("th",{className:"p-1",children:"Time"}),n.jsx("th",{className:"p-1",children:"Balance After"})]})}),n.jsx("tbody",{children:(j=e==null?void 0:e.recent_events)!=null&&j.length?e.recent_events.map((v,p)=>n.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[n.jsx("td",{className:"p-1 text-center text-gray-500",children:p+1}),n.jsx("td",{className:"p-1",children:v.name}),n.jsx("td",{className:"p-1",children:v.rfid}),n.jsx("td",{className:"p-1",children:v.action}),n.jsxs("td",{className:"p-1",children:["â‚±",v.amount]}),n.jsx("td",{className:"p-1",children:v.time}),n.jsxs("td",{className:"p-1",children:["â‚±",v.balance]})]},p)):n.jsx("tr",{children:n.jsx("td",{colSpan:"7",className:"p-2 text-center text-gray-500 text-xs",children:"No recent subscription events available."})})})]})]})]})},F=({title:e,value:r,color:t})=>n.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm",children:[n.jsx("h2",{className:"text-xs text-gray-500",children:e}),n.jsx("p",{className:`text-lg font-bold ${t}`,children:r})]}),K=({title:e,children:r})=>n.jsxs("div",{className:"bg-white p-2 rounded-md shadow-sm",children:[n.jsx("h2",{className:"text-sm font-semibold text-gray-800 mb-1",children:e}),n.jsx("div",{className:"w-full h-52 sm:h-64",children:r})]}),Ye=()=>{const[e,r]=y.useState(null),[t,a]=y.useState(""),[s,i]=y.useState(!0),[l,o]=y.useState(null);return y.useEffect(()=>{(async()=>{var d;try{i(!0),o(null);const{data:u}=await P.get("/api/me");if(console.log("ðŸ“¥ Admin info response (Dashboard):",u),!u.authenticated||!u.user)throw new Error("Not authenticated");if(u.user.role!=="admin"&&u.user.role!=="owner")throw new Error("Only admin/owner can access Analytical Dashboard");r(u.user);const h=u.user.systemType||u.user.system_type||"";a(h),console.log("ðŸ” System type:",h)}catch(u){console.error("âŒ Failed to fetch admin info:",u),o(u.message||"Failed to fetch admin info"),((d=u.response)==null?void 0:d.status)===401&&(window.location.href="/login")}finally{i(!1)}})()},[]),s?n.jsxs("div",{className:"flex",children:[n.jsx(T,{}),n.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[n.jsx("div",{className:"text-4xl mb-4",children:"â³"}),n.jsx("p",{className:"text-gray-600",children:"Loading Analytical Dashboard..."})]})]}):l?n.jsxs("div",{className:"flex",children:[n.jsx(T,{}),n.jsxs("div",{className:"flex-1 p-6 text-center py-12",children:[n.jsx("div",{className:"text-6xl mb-4",children:"âŒ"}),n.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Error"}),n.jsx("p",{className:"text-gray-600 mb-4",children:l}),n.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})]}):t?n.jsxs("div",{className:"flex",children:[n.jsx(T,{}),n.jsx("div",{className:"flex-1 p-4",children:t==="prepaid_entry"?n.jsx(We,{adminUser:e}):t==="subscription"?n.jsx(He,{adminUser:e}):n.jsxs("div",{className:"text-gray-600",children:['Unknown system type: "',t,'". Please contact support.']})})]}):n.jsxs("div",{className:"flex",children:[n.jsx(T,{}),n.jsx("div",{className:"flex-1 p-6 text-center py-12 text-gray-600",children:"Unknown system type. Please contact support."})]})};export{Ye as default};
