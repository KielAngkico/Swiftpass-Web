import{r as l,j as e,d as f}from"./index-BYZoeFiF.js";import{O as M}from"./OwnerSidebar-CZ0OhogK.js";import"./index-D-5OJeWc.js";const _=({title:r,value:m,color:d})=>e.jsxs("div",{className:"bg-white shadow p-2 rounded text-center",children:[e.jsx("h3",{className:"text-[10px] sm:text-xs text-gray-600 truncate",children:r}),e.jsx("p",{className:`text-sm sm:text-base font-bold ${d}`,children:m})]}),E=()=>{const[r,m]=l.useState(null),[d,j]=l.useState([]),[o,u]=l.useState([]),[g,y]=l.useState([]),[n,N]=l.useState(null),[x,T]=l.useState(""),[h,F]=l.useState("All"),[b,v]=l.useState("All"),[$,w]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const{data:s}=await f.get("/api/me");if(!s.authenticated||!s.user)throw new Error("Not authenticated");m(s.user)}catch(s){console.error(s),window.location.href="/login"}})()},[]),l.useEffect(()=>{if(!(r!=null&&r.id)&&!(r!=null&&r.adminId))return;(async()=>{var s;try{w(!0);const i=r.adminId||r.id,[p,R]=await Promise.all([f.get(`/api/get-admin-transactions/${i}`),f.get(`/api/get-members?admin_id=${i}`)]);j(p.data||[]),u(p.data||[]),y(((s=R.data)==null?void 0:s.members)||[])}catch(i){console.error(i)}finally{w(!1)}})()},[r]),l.useEffect(()=>{let s=d.map(i=>{const p=g.find(R=>R.rfid_tag===i.rfid_tag);return{...i,profile_image_url:(p==null?void 0:p.profile_image_url)||null}});x&&(s=s.filter(i=>{var p;return(p=i.member_name)==null?void 0:p.toLowerCase().includes(x.toLowerCase())})),h!=="All"&&(s=s.filter(i=>i.payment_method===h)),b!=="All"&&(s=s.filter(i=>i.transaction_type===b)),u(s)},[x,h,b,d,g]);const C=d.reduce((t,s)=>t+parseFloat(s.amount||0),0),A=o.length,a=o.filter(t=>t.payment_method==="Cash").reduce((t,s)=>t+parseFloat(s.amount||0),0),c=o.filter(t=>t.payment_method==="GCash").reduce((t,s)=>t+parseFloat(s.amount||0),0);return e.jsxs("div",{className:"min-h-screen w-full bg-white p-2 flex flex-col space-y-3",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-1",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Prepaid Transactions"}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500",children:[o.length," transactions",x&&` matching "${x}"`]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"mx-auto  space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(_,{title:"💰 Total Revenue",value:`₱${C.toFixed(2)}`,color:"text-green-600"}),e.jsx(_,{title:"📄 Total Transactions",value:A,color:"text-blue-600"}),e.jsx(_,{title:"💵 Cash Revenue",value:`₱${a.toFixed(2)}`,color:"text-teal-600"}),e.jsx(_,{title:"📲 Cashless",value:`₱${c.toFixed(2)}`,color:"text-purple-600"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs text-gray-500 mb-1 block",children:"🔍 Search Member"}),e.jsx("input",{type:"text",placeholder:"e.g. John Doe",className:"w-full p-2 border border-gray-300 rounded text-xs sm:text-sm",value:x,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs text-gray-500 mb-1 block",children:"📄 Filter Type"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded text-xs sm:text-sm",value:b,onChange:t=>v(t.target.value),children:[e.jsx("option",{value:"All",children:"All Types"}),e.jsx("option",{value:"new_membership",children:"New Membership"}),e.jsx("option",{value:"tapup",children:"Tap-Up"}),e.jsx("option",{value:"product_purchase",children:"Others"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs text-gray-500 mb-1 block",children:"💳 Filter Method"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded text-xs sm:text-sm",value:h,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"All",children:"All Methods"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"GCash",children:"Cashless"})]})]})]}),o.length===0?e.jsx("p",{className:"text-gray-500 italic text-xs sm:text-sm",children:"No transactions found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[10px] sm:text-xs text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-700 text-white uppercase text-[9px] sm:text-[10px]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"#"}),e.jsx("th",{className:"px-3 py-2",children:"Profile"}),e.jsx("th",{className:"px-3 py-2",children:"Name"}),e.jsx("th",{className:"px-3 py-2",children:"Type"}),e.jsx("th",{className:"px-3 py-2",children:"Plan"}),e.jsx("th",{className:"px-3 py-2",children:"Amount"}),e.jsx("th",{className:"px-3 py-2",children:"Method"}),e.jsx("th",{className:"px-3 py-2",children:"Staff"}),e.jsx("th",{className:"px-3 py-2",children:"Date"}),e.jsx("th",{className:"px-3 py-2",children:"Action"})]})}),e.jsx("tbody",{children:o.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:s+1}),e.jsx("td",{className:"px-3 py-2",children:t.profile_image_url?e.jsx("img",{src:`http://localhost:5000/${t.profile_image_url}`,alt:t.member_name,className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover border"}):e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gray-200 flex items-center justify-center text-[8px] text-gray-500",children:"N/A"})}),e.jsx("td",{className:"px-3 py-2 font-medium text-gray-800",children:t.member_name}),e.jsx("td",{className:"px-3 py-2",children:t.transaction_type}),e.jsx("td",{className:"px-3 py-2",children:t.plan_name||"N/A"}),e.jsxs("td",{className:"px-3 py-2",children:["₱",parseFloat(t.amount).toFixed(2)]}),e.jsx("td",{className:"px-3 py-2",children:t.payment_method}),e.jsx("td",{className:"px-3 py-2",children:t.staff_name}),e.jsx("td",{className:"px-3 py-2",children:new Date(t.transaction_date).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{onClick:()=>N(t),className:"px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-[10px] sm:text-xs",children:"View"})})]},t.transaction_id))})]})})]})})]})},S=({title:r,value:m,color:d})=>e.jsxs("div",{className:"bg-white shadow p-2 rounded text-center",children:[e.jsx("h3",{className:"text-[10px] sm:text-xs text-gray-600 truncate",children:r}),e.jsx("p",{className:`text-sm sm:text-base font-bold ${d}`,children:m})]}),D=()=>{const[r,m]=l.useState(null),[d,j]=l.useState([]),[o,u]=l.useState([]),[g,y]=l.useState([]),[n,N]=l.useState(""),[x,T]=l.useState("All"),[h,F]=l.useState("All"),[b,v]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const{data:c}=await f.get("/api/me");if(!c.authenticated||!c.user)throw new Error("Not authenticated");m(c.user)}catch{window.location.href="/login"}})()},[]),l.useEffect(()=>{if(!(r!=null&&r.id)&&!(r!=null&&r.adminId))return;(async()=>{var c;try{v(!0);const t=r.adminId||r.id,[s,i]=await Promise.all([f.get(`/api/get-admin-transactions/${t}`),f.get(`/api/get-members?admin_id=${t}`)]);j(s.data||[]),u(s.data||[]),y(((c=i.data)==null?void 0:c.members)||[])}finally{v(!1)}})()},[r]),l.useEffect(()=>{let c=d.map(t=>{const s=g.find(i=>i.rfid_tag===t.rfid_tag);return{...t,profile_image_url:(s==null?void 0:s.profile_image_url)||null}});n&&(c=c.filter(t=>{var s;return(s=t.member_name)==null?void 0:s.toLowerCase().includes(n.toLowerCase())})),x!=="All"&&(c=c.filter(t=>t.payment_method===x)),h!=="All"&&(c=c.filter(t=>t.transaction_type===h)),u(c)},[n,x,h,d,g]);const $=d.reduce((a,c)=>a+parseFloat(c.amount||0),0),w=o.length,C=o.filter(a=>a.payment_method==="Cash").reduce((a,c)=>a+parseFloat(c.amount||0),0),A=o.filter(a=>a.payment_method==="GCash").reduce((a,c)=>a+parseFloat(c.amount||0),0);return e.jsxs("div",{className:"min-h-screen w-full bg-white p-2 flex flex-col space-y-3",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-1",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Subscription Transactions"}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500",children:[o.length," transactions",n&&` matching "${n}"`]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"mx-auto space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(S,{title:"💰 Total Revenue",value:`₱${$.toFixed(2)}`,color:"text-green-600"}),e.jsx(S,{title:"📄 Total Transactions",value:w,color:"text-blue-600"}),e.jsx(S,{title:"💵 Cash Revenue",value:`₱${C.toFixed(2)}`,color:"text-teal-600"}),e.jsx(S,{title:"📲 Cashless",value:`₱${A.toFixed(2)}`,color:"text-purple-600"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs text-gray-500 mb-1 block",children:"🔍 Search Member"}),e.jsx("input",{type:"text",placeholder:"e.g. John Doe",className:"w-full p-2 border border-gray-300 rounded text-xs sm:text-sm",value:n,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs text-gray-500 mb-1 block",children:"📄 Filter Type"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded text-xs sm:text-sm",value:h,onChange:a=>F(a.target.value),children:[e.jsx("option",{value:"All",children:"All Types"}),e.jsx("option",{value:"new_membership",children:"New Membership"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"product_purchase",children:"Others"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] sm:text-xs text-gray-500 mb-1 block",children:"💳 Filter Method"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded text-xs sm:text-sm",value:x,onChange:a=>T(a.target.value),children:[e.jsx("option",{value:"All",children:"All Methods"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"GCash",children:"Cashless"})]})]})]}),o.length===0?e.jsx("p",{className:"text-gray-500 italic text-xs sm:text-sm",children:"No transactions found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[10px] sm:text-xs text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-700 text-white uppercase text-[9px] sm:text-[10px]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"#"}),e.jsx("th",{className:"px-3 py-2",children:"Profile"}),e.jsx("th",{className:"px-3 py-2",children:"Name"}),e.jsx("th",{className:"px-3 py-2",children:"Type"}),e.jsx("th",{className:"px-3 py-2",children:"Plan"}),e.jsx("th",{className:"px-3 py-2",children:"Amount"}),e.jsx("th",{className:"px-3 py-2",children:"Method"}),e.jsx("th",{className:"px-3 py-2",children:"Staff"}),e.jsx("th",{className:"px-3 py-2",children:"Date"}),e.jsx("th",{className:"px-3 py-2",children:"Action"})]})}),e.jsx("tbody",{children:o.map((a,c)=>e.jsxs("tr",{className:c%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:c+1}),e.jsx("td",{className:"px-3 py-2",children:a.profile_image_url?e.jsx("img",{src:`http://localhost:5000/${a.profile_image_url}`,alt:a.member_name,className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover border"}):e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gray-200 flex items-center justify-center text-[8px] text-gray-500",children:"N/A"})}),e.jsx("td",{className:"px-3 py-2 font-medium text-gray-800",children:a.member_name}),e.jsx("td",{className:"px-3 py-2",children:a.transaction_type}),e.jsx("td",{className:"px-3 py-2",children:a.plan_name||"N/A"}),e.jsxs("td",{className:"px-3 py-2",children:["₱",parseFloat(a.amount).toFixed(2)]}),e.jsx("td",{className:"px-3 py-2",children:a.payment_method}),e.jsx("td",{className:"px-3 py-2",children:a.staff_name}),e.jsx("td",{className:"px-3 py-2",children:new Date(a.transaction_date).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-[10px] sm:text-xs",children:"View"})})]},a.transaction_id))})]})})]})})]})},P=()=>{const[r,m]=l.useState(""),[d,j]=l.useState(!0),[o,u]=l.useState(null);return l.useEffect(()=>{(async()=>{var y;try{j(!0),u(null);const{data:n}=await f.get("/api/me");if(console.log("📥 User info response:",n),!n.authenticated||!n.user)throw new Error("Not authenticated");const N=n.user.systemType||n.user.system_type||"";console.log("🔍 System type:",N),m(N)}catch(n){console.error("❌ Failed to fetch user info:",n),u(n.message||"Failed to load user"),((y=n.response)==null?void 0:y.status)===401&&(window.location.href="/login")}finally{j(!1)}})()},[]),d?e.jsx("div",{className:"p-6 text-gray-600",children:"Loading user..."}):o?e.jsxs("div",{className:"p-6 text-red-600",children:["Error: ",o]}):e.jsxs("div",{className:"flex",children:[e.jsx(M,{}),e.jsx("div",{className:"flex-1 p-4",children:r==="prepaid_entry"?e.jsx(E,{}):e.jsx(D,{})})]})};export{P as default};
