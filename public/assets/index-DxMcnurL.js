import{j as e,r as l,d as g}from"./index-BYZoeFiF.js";import{O as C}from"./OwnerSidebar-CZ0OhogK.js";import"./index-D-5OJeWc.js";const L=({member:s,onClose:n})=>s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 relative animate-fade-in overflow-hidden",children:[n&&e.jsx("button",{onClick:n,className:"absolute top-2 right-3 text-white hover:text-gray-200 text-2xl font-bold z-10","aria-label":"Close",children:"×"}),e.jsxs("div",{className:"relative w-full h-80",children:[e.jsx("img",{src:`http://localhost:5000/${s.profile_image_url}`,alt:s.full_name,className:"absolute inset-0 w-full h-full object-cover brightness-90"}),e.jsxs("div",{className:"absolute bottom-0 w-full bg-gradient-to-t from-black/60 to-transparent px-4 py-2",children:[e.jsx("h2",{className:"text-white text-lg font-bold",children:s.full_name}),e.jsx("p",{className:"text-sm text-white/80",children:"Prepaid Member"})]})]}),e.jsx("div",{className:"px-6 py-4 text-sm text-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"RFID:"})," ",s.rfid_tag]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Age:"})," ",s.age]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.phone_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Joined:"})," ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Balance:"})," ",e.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded-full font-semibold",children:["₱",parseFloat(s.current_balance||0).toFixed(2)]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded-full font-semibold ${s.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status})]})]})})]})}):null,S=({title:s,value:n,color:c})=>e.jsxs("div",{className:"bg-white shadow p-4 rounded text-center",children:[e.jsx("h3",{className:"text-sm text-gray-600",children:s}),e.jsx("p",{className:`text-xl font-bold ${c}`,children:n})]}),k=()=>{const[s,n]=l.useState([]),[c,m]=l.useState(""),[p,o]=l.useState(!1),[M,d]=l.useState(null),[i,x]=l.useState(null),[h,j]=l.useState("All"),[A,b]=l.useState(null);l.useRef(null),l.useEffect(()=>{(async()=>{var a;try{o(!0),d(null);const{data:r}=await g.get("/api/me");if(console.log("📥 User info response:",r),!r.authenticated||!r.user)throw new Error("Not authenticated");b(r.user);const f=r.user.adminId||r.user.id;if(!f)return;const v=await g.get(`/api/get-members?admin_id=${f}`);n(v.data.members||[])}catch(r){console.error("❌ Error fetching user or members:",r),d({message:"Failed to fetch members",type:"error"}),((a=r.response)==null?void 0:a.status)===401&&(window.location.href="/login")}finally{o(!1)}})()},[]);const u=s.filter(t=>{var a;return(a=t.full_name)==null?void 0:a.toLowerCase().includes(c.toLowerCase())}).filter(t=>h==="All"?!0:(t.status||"").toLowerCase()===h.toLowerCase()),N=s.length,y=s.filter(t=>(t.status||"").toLowerCase()==="active").length,w=s.filter(t=>(t.status||"").toLowerCase()==="inactive").length;return e.jsxs("div",{className:"min-h-screen w-full bg-white p-2 flex flex-col space-y-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Prepaid Members"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Overview of member activity and balances"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx(S,{title:"Total Members",value:N,color:"text-indigo-600"}),e.jsx(S,{title:"Active Members",value:y,color:"text-green-600"}),e.jsx(S,{title:"Inactive Members",value:w,color:"text-red-600"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"🔍 Search by Member"}),e.jsx("input",{type:"text",placeholder:"e.g. Maria Santiago",className:"p-2 border border-gray-300 rounded w-full text-xs",value:c,onChange:t=>m(t.target.value)})]}),e.jsxs("div",{className:"flex-1 sm:w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"🧍‍♂️ Filter by Status"}),e.jsxs("select",{className:"p-2 border border-gray-300 rounded w-full text-xs",value:h,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"All",children:"All Members"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),p?e.jsx("p",{className:"text-gray-600 text-xs",children:"Loading members..."}):u.length===0?e.jsx("p",{className:"text-gray-500 italic text-xs",children:"No members found."}):e.jsx("div",{className:"overflow-x-auto rounded shadow",children:e.jsxs("table",{className:"min-w-full text-left text-[10px] sm:text-xs",children:[e.jsx("thead",{className:"bg-gray-700 text-white uppercase text-[9px] sm:text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"#"}),e.jsx("th",{className:"px-2 py-1",children:"Profile"}),e.jsx("th",{className:"px-2 py-1",children:"Name"}),e.jsx("th",{className:"px-2 py-1",children:"Phone"}),e.jsx("th",{className:"px-2 py-1",children:"Balance"}),e.jsx("th",{className:"px-2 py-1",children:"Status"}),e.jsx("th",{className:"px-2 py-1",children:"Actions"})]})}),e.jsx("tbody",{children:u.map((t,a)=>e.jsxs("tr",{className:a%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1",children:a+1}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("img",{src:`http://localhost:5000/${t.profile_image_url||"default-profile.png"}`,alt:t.full_name,className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover border"})}),e.jsx("td",{className:"px-2 py-1 font-medium",children:t.full_name}),e.jsx("td",{className:"px-2 py-1",children:t.phone_number}),e.jsx("td",{className:"px-2 py-1",children:e.jsxs("span",{className:"inline-block px-2 py-0.5 text-[9px] sm:text-xs font-semibold rounded-full bg-green-100 text-green-700 shadow-sm",children:["₱",parseFloat(t.current_balance||0).toFixed(2)]})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("span",{className:`inline-block px-2 py-0.5 text-[9px] sm:text-xs font-semibold rounded-full shadow-sm ${t.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("button",{onClick:()=>x(t),className:"px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",children:"View"})})]},t.rfid_tag||a))})]})}),i&&e.jsx(L,{member:i,onClose:()=>x(null)})]})},F=({member:s,onClose:n})=>s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 relative animate-fade-in overflow-hidden",children:[n&&e.jsx("button",{onClick:n,className:"absolute top-2 right-3 text-white hover:text-gray-200 text-2xl font-bold z-10","aria-label":"Close",children:"×"}),e.jsxs("div",{className:"relative w-full h-80",children:[e.jsx("img",{src:`http://localhost:5000/${s.profile_image_url}`,alt:s.full_name,className:"absolute inset-0 w-full h-full object-cover brightness-90"}),e.jsxs("div",{className:"absolute bottom-0 w-full bg-gradient-to-t from-black/60 to-transparent px-4 py-2",children:[e.jsx("h2",{className:"text-white text-lg font-bold",children:s.full_name}),e.jsx("p",{className:"text-sm text-white/80",children:s.subscription_type||"Subscription Member"})]})]}),e.jsx("div",{className:"px-6 py-4 text-sm text-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"RFID:"})," ",s.rfid_tag]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Age:"})," ",s.age]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.phone_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Joined:"})," ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Plan:"})," ",s.subscription_type||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Expires:"})," ",new Date(s.subscription_expiry).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded-full font-semibold ${s.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status})]})]})})]})}):null,_=({title:s,value:n,color:c})=>e.jsxs("div",{className:"bg-white shadow p-2 sm:p-4 rounded text-center text-xs sm:text-sm",children:[e.jsx("h3",{className:"text-gray-600 truncate",children:s}),e.jsx("p",{className:`text-lg sm:text-xl font-bold ${c}`,children:n})]}),E=()=>{const[s,n]=l.useState([]),[c,m]=l.useState(""),[p,o]=l.useState(!1),[M,d]=l.useState(null),[i,x]=l.useState(null),[h,j]=l.useState("All"),[A,b]=l.useState(null);l.useRef(null),l.useEffect(()=>{(async()=>{var a;try{o(!0),d(null);const{data:r}=await g.get("/api/me");if(!r.authenticated||!r.user)throw new Error("Not authenticated");b(r.user);const f=r.user.adminId||r.user.id;if(!f)return;const v=await g.get(`/api/get-members?admin_id=${f}`);n(v.data.members||[])}catch(r){d({message:"Failed to fetch members",type:"error"}),((a=r.response)==null?void 0:a.status)===401&&(window.location.href="/login")}finally{o(!1)}})()},[]);const u=s.filter(t=>{var a;return(a=t.full_name)==null?void 0:a.toLowerCase().includes(c.toLowerCase())}).filter(t=>h==="All"?!0:(t.status||"").toLowerCase()===h.toLowerCase()),N=s.length,y=s.filter(t=>(t.status||"").toLowerCase()==="active").length,w=s.filter(t=>(t.status||"").toLowerCase()==="inactive").length;return e.jsxs("div",{className:"min-h-screen w-full bg-white p-2 flex flex-col space-y-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold mb-1",children:"Subscription Members"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Overview of subscription member activity"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx(_,{title:"Total Members",value:N,color:"text-indigo-600"}),e.jsx(_,{title:"Active Members",value:y,color:"text-green-600"}),e.jsx(_,{title:"Inactive Members",value:w,color:"text-red-600"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"🔍 Search by Member"}),e.jsx("input",{type:"text",placeholder:"e.g. Maria Santiago",className:"p-2 border border-gray-300 rounded w-full text-xs",value:c,onChange:t=>m(t.target.value)})]}),e.jsxs("div",{className:"flex-1 sm:w-1/3",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"🧍‍♂️ Filter by Status"}),e.jsxs("select",{className:"p-2 border border-gray-300 rounded w-full text-xs",value:h,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"All",children:"All Members"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),p?e.jsx("p",{className:"text-gray-600 text-xs",children:"Loading members..."}):u.length===0?e.jsx("p",{className:"text-gray-500 italic text-xs",children:"No members found."}):e.jsx("div",{className:"overflow-x-auto rounded shadow",children:e.jsxs("table",{className:"min-w-full text-left text-[10px] sm:text-xs",children:[e.jsx("thead",{className:"bg-gray-700 text-white uppercase text-[9px] sm:text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"#"}),e.jsx("th",{className:"px-2 py-1",children:"Profile"}),e.jsx("th",{className:"px-2 py-1",children:"Name"}),e.jsx("th",{className:"px-2 py-1",children:"Phone"}),e.jsx("th",{className:"px-2 py-1",children:"Balance"}),e.jsx("th",{className:"px-2 py-1",children:"Status"}),e.jsx("th",{className:"px-2 py-1",children:"Actions"})]})}),e.jsx("tbody",{children:u.map((t,a)=>e.jsxs("tr",{className:a%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1",children:a+1}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("img",{src:`http://localhost:5000/${t.profile_image_url||"default-profile.png"}`,alt:t.full_name,className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover border"})}),e.jsx("td",{className:"px-2 py-1 font-medium",children:t.full_name}),e.jsx("td",{className:"px-2 py-1",children:t.phone_number}),e.jsx("td",{className:"px-2 py-1",children:e.jsxs("span",{className:"inline-block px-2 py-0.5 text-[9px] sm:text-xs font-semibold rounded-full bg-green-100 text-green-700 shadow-sm",children:["₱",parseFloat(t.current_balance||0).toFixed(2)]})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("span",{className:`inline-block px-2 py-0.5 text-[9px] sm:text-xs font-semibold rounded-full shadow-sm ${t.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("button",{onClick:()=>x(t),className:"px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",children:"View"})})]},t.rfid_tag||a))})]})}),i&&e.jsx(F,{member:i,onClose:()=>x(null)})]})},D=()=>{const[s,n]=l.useState(""),[c,m]=l.useState(!0),[p,o]=l.useState(null);return l.useEffect(()=>{(async()=>{var d;try{m(!0),o(null);const{data:i}=await g.get("/api/me");if(console.log("📥 Admin info response:",i),!i.authenticated||!i.user)throw new Error("Not authenticated");const x=i.user.systemType||i.user.system_type||"";console.log("🔍 Admin system type:",x),n(x)}catch(i){console.error("❌ Failed to fetch admin info:",i),o(i.message||"Failed to fetch admin info"),((d=i.response)==null?void 0:d.status)===401&&(window.location.href="/login")}finally{m(!1)}})()},[]),c?e.jsx("div",{className:"p-4 text-gray-600",children:"Loading user data..."}):p?e.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",p]}):e.jsxs("div",{className:"flex",children:[e.jsx(C,{}),e.jsx("div",{className:"flex-1 p-4",children:s==="prepaid_entry"?e.jsx(k,{}):s==="subscription"?e.jsx(E,{}):e.jsx("div",{className:"text-gray-600",children:"Unknown system type. Please contact support."})})]})};export{D as default};
